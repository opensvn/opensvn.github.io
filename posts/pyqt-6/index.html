<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>PyQt编程第6章 主窗口 | 招财猫的博客</title>
    <meta property="og:title" content="PyQt编程第6章 主窗口 - 招财猫的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2015-10-21T11:25:57&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2015-10-21T11:25:57&#43;08:00'>
        
    <meta name="Keywords" content="C,C&#43;&#43;,Python,Golang">
    <meta name="description" content="PyQt编程第6章 主窗口">
        
    <meta name="author" content="招财猫">
    <meta property="og:url" content="https://gitop.cc/posts/pyqt-6/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-4031353640611810",
        enable_page_level_ads: true
    });
    </script>
    


    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://gitop.cc">
                        招财猫的博客
                    </a>
                
                <p class="description">专注于C&#43;&#43;、Python、Golang</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://gitop.cc">首页</a>
                    
                    <a  href="https://gitop.cc/archives/" title="归档">归档</a>
                    
                    <a  href="https://gitop.cc/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents"></nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">PyQt编程第6章 主窗口</h1>
        </header>
        <date class="post-meta meta-date">
            2015年10月21日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='https://gitop.cc/categories/GUI'>GUI</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h1 id="创建一个主窗口">创建一个主窗口</h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">platform</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
<span style="color:#000;font-weight:bold">from</span> <span style="color:#555">PyQt4.QtCore</span> <span style="color:#000;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">*</span>
<span style="color:#000;font-weight:bold">from</span> <span style="color:#555">PyQt4.QtGui</span> <span style="color:#000;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">*</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">helpform</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">newimagedlg</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">qrc_resources</span>
__version__ <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;1.0.0&#34;</span></code></pre></div>
<p><code>import</code>的顺序：先Python标准模块，然后第三方模块(比如PyQt)，最后自己定义的模块。
一个程序通常有一个版本字符串，按照惯例称为<code>__version__</code>。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MainWindow</span>(QMainWindow):
    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, parent<span style="color:#000;font-weight:bold">=</span><span style="color:#999">None</span>):
        <span style="color:#0086b3">super</span>(MainWindow, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(parent)
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image <span style="color:#000;font-weight:bold">=</span> QImage()
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">False</span>
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">None</span>
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>mirroredvertically <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">False</span>
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>mirroredhorizontally <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">False</span></code></pre></div>
<p><code>QImage</code>并不是继承自<code>QObject</code>，不需要<code>parent</code>。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel <span style="color:#000;font-weight:bold">=</span> QLabel()
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel<span style="color:#000;font-weight:bold">.</span>setMinimumSize(<span style="color:#099">200</span>, <span style="color:#099">200</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel<span style="color:#000;font-weight:bold">.</span>setAlignment(Qt<span style="color:#000;font-weight:bold">.</span>AlignCenter)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel<span style="color:#000;font-weight:bold">.</span>setContextMenuPolicy(Qt<span style="color:#000;font-weight:bold">.</span>ActionsContextMenu)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setCentralWidget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel)</code></pre></div>
<p>PyQt提供许多种方式创建右键菜单，我们使用最简单和最常见的方式。首先必须设置部件的右键菜单策略，然后
给部件添加一些操作。</p>
<p>和对话框不一样，在一个主窗口风格的程序中，只有一个中心部件，尽管它可以是组合而成的。我么只需要调用
<code>setCentralWidget</code>就好了。</p>
<p>在PyQt中，悬浮窗口是<code>QDockWidget</code>类的实例。我们可以添加一个部件到悬浮部件。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">logDockWidget <span style="color:#000;font-weight:bold">=</span> QDockWidget(<span style="color:#d14">&#34;Log&#34;</span>, <span style="color:#999">self</span>)
logDockWidget<span style="color:#000;font-weight:bold">.</span>setObjectName(<span style="color:#d14">&#34;LogDockWidget&#34;</span>)
logDockWidget<span style="color:#000;font-weight:bold">.</span>setAllowedAreas(Qt<span style="color:#000;font-weight:bold">.</span>LeftDockWidgetArea<span style="color:#000;font-weight:bold">|</span>
                              Qt<span style="color:#000;font-weight:bold">.</span>RightDockWidgetArea)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>listWidget <span style="color:#000;font-weight:bold">=</span> QListWidget()
logDockWidget<span style="color:#000;font-weight:bold">.</span>setWidget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>listWidget)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addDockWidget(Qt<span style="color:#000;font-weight:bold">.</span>RightDockWidgetArea, logDockWidget)</code></pre></div>
<p>悬浮部件不会被加入布局，所以当创建它们时，需要指定<code>parent</code>。</p>
<p>每一个PyQt对象都可以指定一个对象名字。PyQt使用对象名字区分悬浮部件。
<code>setFeatures</code>方法控制悬浮部件能否移动，悬浮或关闭。</p>
<p><code>QPrinter</code>对象管理打印机操作。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sizeLabel <span style="color:#000;font-weight:bold">=</span> QLabel()
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sizeLabel<span style="color:#000;font-weight:bold">.</span>setFrameStyle(QFrame<span style="color:#000;font-weight:bold">.</span>StyledPanel<span style="color:#000;font-weight:bold">|</span>QFrame<span style="color:#000;font-weight:bold">.</span>Sunken)
status <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>statusBar()
status<span style="color:#000;font-weight:bold">.</span>setSizeGripEnabled(<span style="color:#999">False</span>)
status<span style="color:#000;font-weight:bold">.</span>addPermanentWidget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sizeLabel)
status<span style="color:#000;font-weight:bold">.</span>showMessage(<span style="color:#d14">&#34;Ready&#34;</span>, <span style="color:#099">5000</span>)</code></pre></div>
<p>状态栏由<code>QMainWindow</code>第一次调用<code>statusBar</code>创建。<code>showMessage</code>在状态栏显示信息直到另一个
<code>showMessage</code>被调用或<code>clearMessage</code>被调用。</p>
<h1 id="动作和键序列">动作和键序列</h1>
<p>PyQt用<code>QAction</code>封装用户动作。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fileNewAction <span style="color:#000;font-weight:bold">=</span> QAction(QIcon(<span style="color:#d14">&#34;images/filenew.png&#34;</span>), <span style="color:#d14">&#34;&amp;New&#34;</span>, <span style="color:#999">self</span>)
fileNewAction<span style="color:#000;font-weight:bold">.</span>setShortcut(QKeySequence<span style="color:#000;font-weight:bold">.</span>New)
helpText <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Create a new image&#34;</span>
fileNewAction<span style="color:#000;font-weight:bold">.</span>setToolTip(helpText)
fileNewAction<span style="color:#000;font-weight:bold">.</span>setStatusTip(helpText)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>connect(fileNewAction, SIGNAL(<span style="color:#d14">&#34;triggered()&#34;</span>), <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileNew)</code></pre></div>
<p>许多键序列都标准化了，有些甚至跨平台。比如<code>Ctrl+N</code>对应新建，<code>Ctrl+S</code>对应保存。
<code>QKeySequence</code>提供标准化的键序列常量，如<code>QKeySequence.New</code>，<code>QKeySequence.Paste</code>
对于还未标准化的键序列(或向后兼容的原因)，可以用字符串作为快捷键，setShortcut(&ldquo;Ctrl+Q&rdquo;)。</p>
<p>注意我们给<code>QAction</code>一个self作为父亲。每一个<code>QObject</code>子类(除了顶级窗口)都有一个父亲。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>a.data()</td>
<td align="left">返回QAction a的数据，作为QVariant</td>
</tr>
<tr>
<td>a.setData(v)</td>
<td align="left">设置QAction a的数据为QVariant v</td>
</tr>
<tr>
<td>a.isChecked()</td>
<td align="left">返回True如果QAction a被确认过</td>
</tr>
<tr>
<td>a.setChecked(b)</td>
<td align="left">选与不选QAction a取决于bool b</td>
</tr>
<tr>
<td>a.isEnabled()</td>
<td align="left">返回True如果QAction a生效</td>
</tr>
<tr>
<td>a.setEnabled(b)</td>
<td align="left">生效或失效QAction a取决于bool b</td>
</tr>
<tr>
<td>a.setSeparator(b)</td>
<td align="left">设置QAction a为正常动作或分隔符取决于bool b</td>
</tr>
<tr>
<td>a.setShortcut(k)</td>
<td align="left">设置QAction a的快捷键为QKeySequence k</td>
</tr>
<tr>
<td>a.setStatusTip(s)</td>
<td align="left">设置QAction a的状态提示为string s</td>
</tr>
<tr>
<td>a.setText(s)</td>
<td align="left">设置QAction a的文本为string s</td>
</tr>
<tr>
<td>a.setToolTip(s)</td>
<td align="left">设置QAction a的工具提示为string s</td>
</tr>
<tr>
<td>a.setWhatsThis(s)</td>
<td align="left">设置QAction a的What&rsquo;s This?文本为string s</td>
</tr>
<tr>
<td>a.toggled(b)</td>
<td align="left">这个信号被发射当QAction a的选中状态改变；bool b为True如果动作被选中</td>
</tr>
<tr>
<td>a.triggered(b)</td>
<td align="left">这个信号被发射QAction a被调用；bool b为True如果a被选中</td>
</tr>
</tbody>
</table>
<p>一旦创建了动作，我们就能把它添加到菜单或工具栏。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fileMenu<span style="color:#000;font-weight:bold">.</span>addAction(fileNewAction)
fileToolbar<span style="color:#000;font-weight:bold">.</span>addAction(fileNewAction)</code></pre></div>
<h1 id="资源文件">资源文件</h1>
<p>创建一个资源模块需要做两件事情。第一创建一个<code>.qrc</code>的文件，包含程序详细的资源。然后运行<code>pyrcc4</code>
读取<code>.qrc</code>文件生成资源模块。<code>.qrc</code>是一个XML格式的文件。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#a61717;background-color:#e3d2d2">!</span>DOCTYPE RCC<span style="color:#000;font-weight:bold">&gt;&lt;</span>RCC version<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;1.0&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span>qresource<span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#0086b3">file</span> alias<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;filenew.png&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>images<span style="color:#000;font-weight:bold">/</span>filenew<span style="color:#000;font-weight:bold">.</span>png<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#0086b3">file</span> alias<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fileopen.png&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>images<span style="color:#000;font-weight:bold">/</span>fileopen<span style="color:#000;font-weight:bold">.</span>png<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">···</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#0086b3">file</span> alias<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;icon.png&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>images<span style="color:#000;font-weight:bold">/</span>icon<span style="color:#000;font-weight:bold">.</span>png<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>help<span style="color:#000;font-weight:bold">/</span>editmenu<span style="color:#000;font-weight:bold">.</span>html<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>help<span style="color:#000;font-weight:bold">/</span>filemenu<span style="color:#000;font-weight:bold">.</span>html<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>help<span style="color:#000;font-weight:bold">/</span>index<span style="color:#000;font-weight:bold">.</span>html<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#0086b3">file</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;/</span>qresource<span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">&lt;/</span>RCC<span style="color:#000;font-weight:bold">&gt;</span></code></pre></div>
<p>现在使用一个新建文件的图片，我们可以写成<code>QIcon(&quot;:/images/filenew.png&quot;)</code>，多亏了别名，
也可以缩写为<code>QIcon(&quot;:/filenew.png&quot;)</code>。前面的:/告诉PyQt文件是一个资源。在使用资源之前，
必须生成资源模块并导入进程序。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">C:\pyqt\chap06<span style="color:#000;font-weight:bold">&gt;</span>pyrcc4 <span style="color:#000;font-weight:bold">-</span>o qrc_resources<span style="color:#000;font-weight:bold">.</span>py resources<span style="color:#000;font-weight:bold">.</span>qrc</code></pre></div>
<h1 id="创建和使用动作">创建和使用动作</h1>
<p>一个辅助创建动作的函数：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">createAction</span>(<span style="color:#999">self</span>, text, slot<span style="color:#000;font-weight:bold">=</span><span style="color:#999">None</span>, shortcut<span style="color:#000;font-weight:bold">=</span><span style="color:#999">None</span>, icon<span style="color:#000;font-weight:bold">=</span><span style="color:#999">None</span>,
                 tip<span style="color:#000;font-weight:bold">=</span><span style="color:#999">None</span>, checkable<span style="color:#000;font-weight:bold">=</span><span style="color:#999">False</span>, signal<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;triggered()&#34;</span>):
    action <span style="color:#000;font-weight:bold">=</span> QAction(text, <span style="color:#999">self</span>)
    <span style="color:#000;font-weight:bold">if</span> icon <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span>:
        action<span style="color:#000;font-weight:bold">.</span>setIcon(QIcon(<span style="color:#d14">&#34;:/</span><span style="color:#d14">%s</span><span style="color:#d14">.png&#34;</span> <span style="color:#000;font-weight:bold">%</span> icon))
    <span style="color:#000;font-weight:bold">if</span> shortcut <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span>:
        action<span style="color:#000;font-weight:bold">.</span>setShortcut(shortcut)
    <span style="color:#000;font-weight:bold">if</span> tip <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span>:
        action<span style="color:#000;font-weight:bold">.</span>setToolTip(tip)
        action<span style="color:#000;font-weight:bold">.</span>setStatusTip(tip)
    <span style="color:#000;font-weight:bold">if</span> slot <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span>:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>connect(action, SIGNAL(signal), slot)
    <span style="color:#000;font-weight:bold">if</span> checkable:
        action<span style="color:#000;font-weight:bold">.</span>setCheckable(<span style="color:#999">True</span>)
    <span style="color:#000;font-weight:bold">return</span> action
fileNewAction <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>createAction(<span style="color:#d14">&#34;&amp;New...&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileNew,
        QKeySequence<span style="color:#000;font-weight:bold">.</span>New, <span style="color:#d14">&#34;filenew&#34;</span>, <span style="color:#d14">&#34;Create an image file&#34;</span>)
fileQuitAction <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>createAction(<span style="color:#d14">&#34;&amp;Quit&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>close,
        <span style="color:#d14">&#34;Ctrl+Q&#34;</span>, <span style="color:#d14">&#34;filequit&#34;</span>, <span style="color:#d14">&#34;Close the application&#34;</span>)
editZoomAction <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>createAction(<span style="color:#d14">&#34;&amp;Zoom...&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>editZoom,
        <span style="color:#d14">&#34;Alt+Z&#34;</span>, <span style="color:#d14">&#34;editzoom&#34;</span>, <span style="color:#d14">&#34;Zoom the image&#34;</span>)
editInvertAction <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>createAction(<span style="color:#d14">&#34;&amp;Invert&#34;</span>,
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>editInvert, <span style="color:#d14">&#34;Ctrl+I&#34;</span>, <span style="color:#d14">&#34;editinvert&#34;</span>,
        <span style="color:#d14">&#34;Invert the image&#39;s colors&#34;</span>, <span style="color:#999">True</span>, <span style="color:#d14">&#34;toggled(bool)&#34;</span>)</code></pre></div>
<p><code>toggled(bool)</code>信号不仅告诉我们动作被调用，而且返回动作是否被选中。</p>
<p>一个动作组管理一组动作使得任何时候只有一个动作被选中。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mirrorGroup <span style="color:#000;font-weight:bold">=</span> QActionGroup(<span style="color:#999">self</span>)
editUnMirrorAction <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>createAction(<span style="color:#d14">&#34;&amp;Unmirror&#34;</span>,
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>editUnMirror, <span style="color:#d14">&#34;Ctrl+U&#34;</span>, <span style="color:#d14">&#34;editunmirror&#34;</span>,
        <span style="color:#d14">&#34;Unmirror the image&#34;</span>, <span style="color:#999">True</span>, <span style="color:#d14">&#34;toggled(bool)&#34;</span>)
mirrorGroup<span style="color:#000;font-weight:bold">.</span>addAction(editUnMirrorAction)
editUnMirrorAction<span style="color:#000;font-weight:bold">.</span>setChecked(<span style="color:#999">True</span>)</code></pre></div>
<p>可选中的动作默认是未选中状态，所以在动作组中初始时必须选择一个为选中状态。</p>
<p>虽然所有动作已经创建好，但是它们还不能工作。只有当动作加进菜单或工具栏才能起作用。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">editMenu <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>menuBar()<span style="color:#000;font-weight:bold">.</span>addMenu(<span style="color:#d14">&#34;&amp;Edit&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addActions(editMenu, (editInvertAction,
        editSwapRedAndBlueAction, editZoomAction))
<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">addActions</span>(<span style="color:#999">self</span>, target, actions):
    <span style="color:#000;font-weight:bold">for</span> action <span style="color:#000;font-weight:bold">in</span> actions:
        <span style="color:#000;font-weight:bold">if</span> action <span style="color:#000;font-weight:bold">is</span> <span style="color:#999">None</span>:
            target<span style="color:#000;font-weight:bold">.</span>addSeparator()
        <span style="color:#000;font-weight:bold">else</span>:
            target<span style="color:#000;font-weight:bold">.</span>addAction(action)</code></pre></div>
<p>也可以使用<code>QWidget.addActions</code>添加多个动作到菜单或工具栏。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mirrorMenu <span style="color:#000;font-weight:bold">=</span> editMenu<span style="color:#000;font-weight:bold">.</span>addMenu(QIcon(<span style="color:#d14">&#34;:/editmirror.png&#34;</span>),
                              <span style="color:#d14">&#34;&amp;Mirror&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addActions(mirrorMenu, (editUnMirrorAction,
        editMirrorHorizontalAction, editMirrorVerticalAction))</code></pre></div>
<p>子目录的创建和其它目录一样，不同的是使用<code>QMenu.addMenu</code>加进父目录。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>menuBar()<span style="color:#000;font-weight:bold">.</span>addMenu(<span style="color:#d14">&#34;&amp;File&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenuActions <span style="color:#000;font-weight:bold">=</span> (fileNewAction, fileOpenAction,
        fileSaveAction, fileSaveAsAction, <span style="color:#999">None</span>,
        filePrintAction, fileQuitAction)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>connect(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu, SIGNAL(<span style="color:#d14">&#34;aboutToShow()&#34;</span>),
             <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateFileMenu)

fileToolbar <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addToolBar(<span style="color:#d14">&#34;File&#34;</span>)
fileToolbar<span style="color:#000;font-weight:bold">.</span>setObjectName(<span style="color:#d14">&#34;FileToolBar&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addActions(fileToolbar, (fileNewAction, fileOpenAction,
                              fileSaveAsAction))</code></pre></div>
<p><code>addToolBar</code>创建一个<code>QToolBar</code>对象。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">editToolbar <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addToolBar(<span style="color:#d14">&#34;Edit&#34;</span>)
editToolbar<span style="color:#000;font-weight:bold">.</span>setObjectName(<span style="color:#d14">&#34;EditToolBar&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addActions(editToolbar, (editInvertAction,
        editSwapRedAndBlueAction, editUnMirrorAction,
        editMirrorVerticalAction,
        editMirrorHorizontalAction))</code></pre></div>
<p>添加部件到工具栏都一样： 创建部件，配置好部件，连接信号，然后把部件添加到工具栏</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox <span style="color:#000;font-weight:bold">=</span> QSpinBox()
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>setRange(<span style="color:#099">1</span>, <span style="color:#099">400</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>setSuffix(<span style="color:#d14">&#34; %&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>setValue(<span style="color:#099">100</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>setToolTip(<span style="color:#d14">&#34;Zoom the image&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>setStatusTip(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>toolTip())
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>setFocusPolicy(Qt<span style="color:#000;font-weight:bold">.</span>NoFocus)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>connect(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox,
             SIGNAL(<span style="color:#d14">&#34;valueChanged(int)&#34;</span>), <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>showImage)
editToolbar<span style="color:#000;font-weight:bold">.</span>addWidget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox)</code></pre></div>
<p>之前有一行这样的代码：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel<span style="color:#000;font-weight:bold">.</span>setContextMenuPolicy(Qt<span style="color:#000;font-weight:bold">.</span>ActionsContextMenu)</code></pre></div>
<p>它告诉PyQt，如果动作被加进imageLabel部件，它们也被用作右键菜单。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addActions(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel, (editInvertAction,
        editSwapRedAndBlueAction, editUnMirrorAction,
        editMirrorVerticalAction, editMirrorHorizontalAction))</code></pre></div>
<p><code>QWidget</code>类有一个<code>addAction</code>方法，因此<code>QMenu</code>，<code>QMenuBar</code>，<code>QToolBar</code>都继承了这个方法。
尽管<code>QWidget</code>没有<code>addSeparator</code>方法，为了方便，<code>QMenu</code>，<code>QMenuBar</code>，<code>QToolBar</code>都提供了。
如果要添加一个分隔符到右键菜单，则必须添加一个分隔动作。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">separator <span style="color:#000;font-weight:bold">=</span> QAction(<span style="color:#999">self</span>)
separator<span style="color:#000;font-weight:bold">.</span>setSeparator(<span style="color:#999">True</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addActions(editToolbar, (editInvertAction,
        editSwapRedAndBlueAction, separator, editUnMirrorAction,
        editMirrorVerticalAction, editMirrorHorizontalAction))</code></pre></div>
<h1 id="恢复和保存主窗口状态">恢复和保存主窗口状态</h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">main</span>():
    app <span style="color:#000;font-weight:bold">=</span> QApplication(sys<span style="color:#000;font-weight:bold">.</span>argv)
    app<span style="color:#000;font-weight:bold">.</span>setOrganizationName(<span style="color:#d14">&#34;Qtrac Ltd.&#34;</span>)
    app<span style="color:#000;font-weight:bold">.</span>setOrganizationDomain(<span style="color:#d14">&#34;qtrac.eu&#34;</span>)
    app<span style="color:#000;font-weight:bold">.</span>setApplicationName(<span style="color:#d14">&#34;Image Changer&#34;</span>)
    app<span style="color:#000;font-weight:bold">.</span>setWindowIcon(QIcon(<span style="color:#d14">&#34;:/icon.png&#34;</span>))
    form <span style="color:#000;font-weight:bold">=</span> MainWindow()
    form<span style="color:#000;font-weight:bold">.</span>show()
    app<span style="color:#000;font-weight:bold">.</span>exec_()</code></pre></div>
<p>函数main的第二行到第四行的主要作用就是程序配置的加载和保存。如果不传任何参数给<code>QSettings</code>对象，
则它会使用这三行代码设定的名字。这些名字使得程序配置保存在合适的地方，比如Windows的注册表，Linux
的$HOME/.config</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">settings <span style="color:#000;font-weight:bold">=</span> QSettings()
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles <span style="color:#000;font-weight:bold">=</span> settings<span style="color:#000;font-weight:bold">.</span>value(<span style="color:#d14">&#34;RecentFiles&#34;</span>)<span style="color:#000;font-weight:bold">.</span>toStringList()
size <span style="color:#000;font-weight:bold">=</span> settings<span style="color:#000;font-weight:bold">.</span>value(<span style="color:#d14">&#34;MainWindow/Size&#34;</span>,
                      QVariant(QSize(<span style="color:#099">600</span>, <span style="color:#099">500</span>)))<span style="color:#000;font-weight:bold">.</span>toSize()
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>resize(size)
position <span style="color:#000;font-weight:bold">=</span> settings<span style="color:#000;font-weight:bold">.</span>value(<span style="color:#d14">&#34;MainWindow/Position&#34;</span>,
                          QVariant(QPoint(<span style="color:#099">0</span>, <span style="color:#099">0</span>)))<span style="color:#000;font-weight:bold">.</span>toPoint()
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>move(position)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>restoreState(
        settings<span style="color:#000;font-weight:bold">.</span>value(<span style="color:#d14">&#34;MainWindow/State&#34;</span>)<span style="color:#000;font-weight:bold">.</span>toByteArray())
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setWindowTitle(<span style="color:#d14">&#34;Image Changer&#34;</span>)
<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateFileMenu()
QTimer<span style="color:#000;font-weight:bold">.</span>singleShot(<span style="color:#099">0</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>loadInitialFile)</code></pre></div>
<p><code>QSettings.value()</code>返回一个<code>QVariant</code>，因此必须转换为我们期望的数据类型。
带2个参数形式的<code>value()</code>方法，第二个参数是默认值。</p>
<p><code>resize()</code>和<code>move()</code>并不会造成窗口抖动，因为这些操作是在窗口显示之前已经完成。
Qt4.2引入2个新的方法保存和恢复一个顶层窗口的几何位置。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>restoreGeometry(settings<span style="color:#000;font-weight:bold">.</span>value(<span style="color:#d14">&#34;Geometry&#34;</span>)<span style="color:#000;font-weight:bold">.</span>toByteArray())</code></pre></div>
<p><code>QMainWindow</code>类提供<code>restoreState()</code>和<code>saveState()</code>方法，来恢复自或保存到一个<code>QByteArray</code>。
它们只保存拥有唯一对象名的悬浮窗口的大小和位置以及工具栏的位置。</p>
<blockquote>
<p><strong>启动时做大量处理</strong>
如果我们需要在启动时做大量处理，比如加载许多大文件，我们经常用一个独立的加载方法来做此事。
想象一下，比如这个方法是loadInitialFiles()，加载许多大文件。则在show()和事件循环(exec_())
开始之前，用户将体验到一个非常长的启动延迟。
我们希望窗口尽可能快的出现，使用户知道启动成功，并能够看到长时间运行的进程。这些通过0延迟的
singleShot计时器完成。因为它并不会立即执行连接的槽，相反它简单地将槽放到事件队列就返回。
0延迟计时器意思是，“当事件队列没有其它事件处理时处理这个事件”</p>
</blockquote>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">loadInitialFile</span>(<span style="color:#999">self</span>):
    settings <span style="color:#000;font-weight:bold">=</span> QSettings()
    fname <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">unicode</span>(settings<span style="color:#000;font-weight:bold">.</span>value(<span style="color:#d14">&#34;LastFile&#34;</span>)<span style="color:#000;font-weight:bold">.</span>toString())
    <span style="color:#000;font-weight:bold">if</span> fname <span style="color:#000;font-weight:bold">and</span> QFile<span style="color:#000;font-weight:bold">.</span>exists(fname):
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>loadFile(fname)</code></pre></div>
<p>如果用户试图关闭程序，不管什么方式，<code>closeEvent()</code>被调用。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">closeEvent</span>(<span style="color:#999">self</span>, event):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>okToContinue():
        settings <span style="color:#000;font-weight:bold">=</span> QSettings()
        filename <span style="color:#000;font-weight:bold">=</span> QVariant(QString(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename)) \
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span> <span style="color:#000;font-weight:bold">else</span> QVariant()
        settings<span style="color:#000;font-weight:bold">.</span>setValue(<span style="color:#d14">&#34;LastFile&#34;</span>, filename)
        recentFiles <span style="color:#000;font-weight:bold">=</span> QVariant(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles) \
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles <span style="color:#000;font-weight:bold">else</span> QVariant()
        settings<span style="color:#000;font-weight:bold">.</span>setValue(<span style="color:#d14">&#34;RecentFiles&#34;</span>, recentFiles)
        settings<span style="color:#000;font-weight:bold">.</span>setValue(<span style="color:#d14">&#34;MainWindow/Size&#34;</span>, QVariant(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>size()))
        settings<span style="color:#000;font-weight:bold">.</span>setValue(<span style="color:#d14">&#34;MainWindow/Position&#34;</span>,
                QVariant(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pos()))
        settings<span style="color:#000;font-weight:bold">.</span>setValue(<span style="color:#d14">&#34;MainWindow/State&#34;</span>,
                QVariant(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>saveState()))
    <span style="color:#000;font-weight:bold">else</span>:
        event<span style="color:#000;font-weight:bold">.</span>ignore()</code></pre></div>
<table>
<thead>
<tr>
<th>语法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>m.addDockWidget(a, d)</td>
<td align="left">在QMainWindow m中添加QDockWidget d到Qt.QDockWidgetArea a</td>
</tr>
<tr>
<td>m.addToolBar(s)</td>
<td align="left">添加并返回一个名叫string s的QToolBar</td>
</tr>
<tr>
<td>m.menuBar()</td>
<td align="left">返回QMainWindow m的QMenuBar(第一次调用创建目录)</td>
</tr>
<tr>
<td>m.restoreGeometry(ba)</td>
<td align="left">根据QByteArray ba恢复QMainWindow m的位置和大小(Qt4.3)</td>
</tr>
<tr>
<td>m.restoreState(ba)</td>
<td align="left">根据QByteArray ba恢复QMainWindow m的悬浮窗和工具栏的状态</td>
</tr>
<tr>
<td>m.saveGeometry()</td>
<td align="left">返回封装在QByteArray中QMainWindow m的位置和大小(Qt4.3)</td>
</tr>
<tr>
<td>m.saveState()</td>
<td align="left">返回封装在QByteArray中QMainWindow m的悬浮窗和工具栏的状态</td>
</tr>
<tr>
<td>m.setCentralWidget(w)</td>
<td align="left">设置QMainWindow m的中央部件为QWidget w</td>
</tr>
<tr>
<td>m.statusBar()</td>
<td align="left">返回QMainWindow的QStatusBar(第一次调用创建状态栏)</td>
</tr>
<tr>
<td>m.setWindowIcon(i)</td>
<td align="left">设置QMainWindow m的图标为QIcon i；这个方法继承自QWidget</td>
</tr>
<tr>
<td>m.setWindowTitle(s)</td>
<td align="left">设置QMainWindow m的标题为string s；这个方法继承自QWidget</td>
</tr>
</tbody>
</table>
<p>如果我们使用Qt4，使用<code>QWidget.restoreGeometry()</code>恢复窗口的几何位置，那么我们可以如此保存几何状态：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">settings<span style="color:#000;font-weight:bold">.</span>setValue(<span style="color:#d14">&#34;Geometry&#34;</span>, QVariant(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>saveGeometry()))</code></pre></div>
<p>使用这种方法，不需要单独保存主窗口的大小和位置。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">okToContinue</span>(<span style="color:#999">self</span>):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty:
    reply <span style="color:#000;font-weight:bold">=</span> QMessageBox<span style="color:#000;font-weight:bold">.</span>question(<span style="color:#999">self</span>,
                    <span style="color:#d14">&#34;Image Changer - Unsaved Changes&#34;</span>,
                    <span style="color:#d14">&#34;Save unsaved changes?&#34;</span>,
                    QMessageBox<span style="color:#000;font-weight:bold">.</span>Yes<span style="color:#000;font-weight:bold">|</span>QMessageBox<span style="color:#000;font-weight:bold">.</span>No<span style="color:#000;font-weight:bold">|</span>
                    QMessageBox<span style="color:#000;font-weight:bold">.</span>Cancel)
    <span style="color:#000;font-weight:bold">if</span> reply <span style="color:#000;font-weight:bold">==</span> QMessageBox<span style="color:#000;font-weight:bold">.</span>Cancel:
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">False</span>
    <span style="color:#000;font-weight:bold">elif</span> reply <span style="color:#000;font-weight:bold">==</span> QMessageBox<span style="color:#000;font-weight:bold">.</span>Yes:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileSave()
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#999">True</span></code></pre></div>
<p>有些开发者使用<code>QMessageBox.Save</code>和<code>QMessageBox.Discard</code>。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">updateFileMenu</span>(<span style="color:#999">self</span>):
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu<span style="color:#000;font-weight:bold">.</span>clear()
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addActions(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenuActions[:<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>])
    current <span style="color:#000;font-weight:bold">=</span> QString(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename) \
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#999">None</span>
    recentFiles <span style="color:#000;font-weight:bold">=</span> []
    <span style="color:#000;font-weight:bold">for</span> fname <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles:
        <span style="color:#000;font-weight:bold">if</span> fname <span style="color:#000;font-weight:bold">!=</span> current <span style="color:#000;font-weight:bold">and</span> QFile<span style="color:#000;font-weight:bold">.</span>exists(fname):
            recentFiles<span style="color:#000;font-weight:bold">.</span>append(fname)
    <span style="color:#000;font-weight:bold">if</span> recentFiles:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu<span style="color:#000;font-weight:bold">.</span>addSeparator()
        <span style="color:#000;font-weight:bold">for</span> i, fname <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">enumerate</span>(recentFiles):
            action <span style="color:#000;font-weight:bold">=</span> QAction(QIcon(<span style="color:#d14">&#34;:/icon.png&#34;</span>), <span style="color:#d14">&#34;&amp;</span><span style="color:#d14">%d</span><span style="color:#d14"> </span><span style="color:#d14">%s</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> (
                    i <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>, QFileInfo(fname)<span style="color:#000;font-weight:bold">.</span>fileName()), <span style="color:#999">self</span>)
            action<span style="color:#000;font-weight:bold">.</span>setData(QVariant(fname))
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>connect(action, SIGNAL(<span style="color:#d14">&#34;triggered()&#34;</span>),
                         <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>loadFile)
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu<span style="color:#000;font-weight:bold">.</span>addAction(action)
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu<span style="color:#000;font-weight:bold">.</span>addSeparator()
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenu<span style="color:#000;font-weight:bold">.</span>addAction(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileMenuActions[<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>])</code></pre></div>
<blockquote>
<p><strong>QMessageBox的静态方法</strong>
QMessageBox类提供多个方便的静态方法，这些方法弹出一个有合适图标和按钮的模式对话框。
最常用的方法为critical()，information()，question()和waring()。这些方法携带参数
父类部件，窗口标题，消息文本(可以是纯文本或HTML)，0个或多个按钮。如果未指定按钮，则为OK按钮。
Qt4.0和Qt4.1中，OK按钮或Yes按钮位或QMessageBox.Default，Cancel按钮或No按钮位或
QMessageBox.Escape很常见。
reply = QMessageBox.question(self,
&ldquo;Image Changer - Unsaved Changes&rdquo;, &ldquo;Save unsaved changes?&quot;,
QMessageBox.Yes|QMessageBox.Default,
QMessageBox.No|QMessageBox.Escape)
4.2中则自动绑定默认动作到相应的按钮上。
如果我们想创建自定义的消息框，可以创建一个QMessageBox实例，然后使用QMessageBox.addButton()
QMessageBox.setIcon()添加按钮，再调用QMessageBox.exec_()弹出消息框。</p>
</blockquote>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">addRecentFile</span>(<span style="color:#999">self</span>, fname):
    <span style="color:#000;font-weight:bold">if</span> fname <span style="color:#000;font-weight:bold">is</span> <span style="color:#999">None</span>:
        <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles<span style="color:#000;font-weight:bold">.</span>contains(fname):
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles<span style="color:#000;font-weight:bold">.</span>prepend(QString(fname))
        <span style="color:#000;font-weight:bold">while</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles<span style="color:#000;font-weight:bold">.</span>count() <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">9</span>:
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>recentFiles<span style="color:#000;font-weight:bold">.</span>takeLast()</code></pre></div>
<h1 id="处理文件动作">处理文件动作</h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fileNew</span>(<span style="color:#999">self</span>):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>okToContinue():
        <span style="color:#000;font-weight:bold">return</span>
    dialog <span style="color:#000;font-weight:bold">=</span> newimagedlg<span style="color:#000;font-weight:bold">.</span>NewImageDlg(<span style="color:#999">self</span>)
    <span style="color:#000;font-weight:bold">if</span> dialog<span style="color:#000;font-weight:bold">.</span>exec_():
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addRecentFile(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename)
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image <span style="color:#000;font-weight:bold">=</span> QImage()
        <span style="color:#000;font-weight:bold">for</span> action, check <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>resetableActions:
            action<span style="color:#000;font-weight:bold">.</span>setChecked(check)
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image <span style="color:#000;font-weight:bold">=</span> dialog<span style="color:#000;font-weight:bold">.</span>image()
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">None</span>
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">True</span>
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>showImage()
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sizeLabel<span style="color:#000;font-weight:bold">.</span>setText(<span style="color:#d14">&#34;</span><span style="color:#d14">%d</span><span style="color:#d14"> x </span><span style="color:#d14">%d</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> (<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>width(),
                                            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>height()))
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateStatus(<span style="color:#d14">&#34;Created new image&#34;</span>)

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">updateStatus</span>(<span style="color:#999">self</span>, message):
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>statusBar()<span style="color:#000;font-weight:bold">.</span>showMessage(message, <span style="color:#099">5000</span>)
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>listWidget<span style="color:#000;font-weight:bold">.</span>addItem(message)
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span>:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setWindowTitle(<span style="color:#d14">&#34;Image Changer - </span><span style="color:#d14">%s</span><span style="color:#d14">[*]&#34;</span> <span style="color:#000;font-weight:bold">%</span> \
                            os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>basename(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename))
    <span style="color:#000;font-weight:bold">elif</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setWindowTitle(<span style="color:#d14">&#34;Image Changer - Unnamed[*]&#34;</span>)
    <span style="color:#000;font-weight:bold">else</span>:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setWindowTitle(<span style="color:#d14">&#34;Image Changer[*]&#34;</span>)
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>setWindowModified(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty)

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fileOpen</span>(<span style="color:#999">self</span>):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>okToContinue():
        <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#0086b3">dir</span> <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>dirname(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename) \
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#d14">&#34;.&#34;</span>
    formats <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#34;*.</span><span style="color:#d14">%s</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> <span style="color:#0086b3">unicode</span>(format)<span style="color:#000;font-weight:bold">.</span>lower() \
               <span style="color:#000;font-weight:bold">for</span> format <span style="color:#000;font-weight:bold">in</span> QImageReader<span style="color:#000;font-weight:bold">.</span>supportedImageFormats()]
    fname <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">unicode</span>(QFileDialog<span style="color:#000;font-weight:bold">.</span>getOpenFileName(<span style="color:#999">self</span>,
                        <span style="color:#d14">&#34;Image Changer - Choose Image&#34;</span>, <span style="color:#0086b3">dir</span>,
                        <span style="color:#d14">&#34;Image files (</span><span style="color:#d14">%s</span><span style="color:#d14">)&#34;</span> <span style="color:#000;font-weight:bold">%</span> <span style="color:#d14">&#34; &#34;</span><span style="color:#000;font-weight:bold">.</span>join(formats)))
    <span style="color:#000;font-weight:bold">if</span> fname:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>loadFile(fname)</code></pre></div>
<p><code>QFileDialog.getOpenFileName()</code>返回一个<code>QString</code>保存文件名的绝对路径，或者返回空。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fname <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">unicode</span>(QFileDialog<span style="color:#000;font-weight:bold">.</span>getOpenFileName(<span style="color:#999">self</span>,
                <span style="color:#d14">&#34;</span><span style="color:#d14">%s</span><span style="color:#d14"> - Choose Image&#34;</span> <span style="color:#000;font-weight:bold">%</span> QApplication<span style="color:#000;font-weight:bold">.</span>applicationName(),
                <span style="color:#0086b3">dir</span>, <span style="color:#d14">&#34;Image files (</span><span style="color:#d14">%s</span><span style="color:#d14">)&#34;</span> <span style="color:#000;font-weight:bold">%</span> <span style="color:#d14">&#34; &#34;</span><span style="color:#000;font-weight:bold">.</span>join(formats)))

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">loadFile</span>(<span style="color:#999">self</span>, fname<span style="color:#000;font-weight:bold">=</span><span style="color:#999">None</span>):
    <span style="color:#000;font-weight:bold">if</span> fname <span style="color:#000;font-weight:bold">is</span> <span style="color:#999">None</span>:
        action <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sender()
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">isinstance</span>(action, QAction):
            fname <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">unicode</span>(action<span style="color:#000;font-weight:bold">.</span>data()<span style="color:#000;font-weight:bold">.</span>toString())
            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>okToContinue():
                <span style="color:#000;font-weight:bold">return</span>
        <span style="color:#000;font-weight:bold">else</span>:
            <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#000;font-weight:bold">if</span> fname:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">None</span>
        image <span style="color:#000;font-weight:bold">=</span> QImage(fname)
        <span style="color:#000;font-weight:bold">if</span> image<span style="color:#000;font-weight:bold">.</span>isNull():
            message <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Failed to read </span><span style="color:#d14">%s</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> fname
        <span style="color:#000;font-weight:bold">else</span>:
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addRecentFile(fname)
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image <span style="color:#000;font-weight:bold">=</span> QImage()
            <span style="color:#000;font-weight:bold">for</span> action, check <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>resetableActions:
                action<span style="color:#000;font-weight:bold">.</span>setChecked(check)
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image <span style="color:#000;font-weight:bold">=</span> image
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">=</span> fname
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>showImage()
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">False</span>
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sizeLabel<span style="color:#000;font-weight:bold">.</span>setText(<span style="color:#d14">&#34;</span><span style="color:#d14">%d</span><span style="color:#d14"> x </span><span style="color:#d14">%d</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> (
                        image<span style="color:#000;font-weight:bold">.</span>width(), image<span style="color:#000;font-weight:bold">.</span>height()))
            message <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Loaded </span><span style="color:#d14">%s</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> os<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>basename(fname)
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateStatus(message)

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fileSave</span>(<span style="color:#999">self</span>):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">is</span> <span style="color:#999">None</span>:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileSaveAs()
    <span style="color:#000;font-weight:bold">else</span>:
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>save(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename, <span style="color:#999">None</span>):
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateStatus(<span style="color:#d14">&#34;Saved as </span><span style="color:#d14">%s</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename)
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">False</span>
        <span style="color:#000;font-weight:bold">else</span>:
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateStatus(<span style="color:#d14">&#34;Failed to save </span><span style="color:#d14">%s</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename)

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fileSaveAs</span>(<span style="color:#999">self</span>):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#000;font-weight:bold">return</span>
    fname <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">None</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#d14">&#34;.&#34;</span>
    formats <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#34;*.</span><span style="color:#d14">%s</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">%</span> <span style="color:#0086b3">unicode</span>(format)<span style="color:#000;font-weight:bold">.</span>lower() \
               <span style="color:#000;font-weight:bold">for</span> format <span style="color:#000;font-weight:bold">in</span> QImageWriter<span style="color:#000;font-weight:bold">.</span>supportedImageFormats()]
    fname <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">unicode</span>(QFileDialog<span style="color:#000;font-weight:bold">.</span>getSaveFileName(<span style="color:#999">self</span>,
                    <span style="color:#d14">&#34;Image Changer - Save Image&#34;</span>, fname,
                    <span style="color:#d14">&#34;Image files (</span><span style="color:#d14">%s</span><span style="color:#d14">)&#34;</span> <span style="color:#000;font-weight:bold">%</span> <span style="color:#d14">&#34; &#34;</span><span style="color:#000;font-weight:bold">.</span>join(formats)))
    <span style="color:#000;font-weight:bold">if</span> fname:
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">&#34;.&#34;</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">in</span> fname:
            fname <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">&#34;.png&#34;</span>
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>addRecentFile(fname)
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>filename <span style="color:#000;font-weight:bold">=</span> fname
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fileSave()</code></pre></div>
<p>QFileDialog.getSaveFileName()提示用户提供一个文件名用来保存当前文件。</p>
<h1 id="处理编辑动作">处理编辑动作</h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">editInvert</span>(<span style="color:#999">self</span>, on):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>invertPixels()
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>showImage()
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">True</span>
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateStatus(<span style="color:#d14">&#34;Inverted&#34;</span> <span style="color:#000;font-weight:bold">if</span> on <span style="color:#000;font-weight:bold">else</span> <span style="color:#d14">&#34;Uninverted&#34;</span>)

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">editMirrorHorizontal</span>(<span style="color:#999">self</span>, on):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>mirrored(<span style="color:#999">True</span>, <span style="color:#999">False</span>)
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>showImage()
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>mirroredhorizontally <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>mirroredhorizontally
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>dirty <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">True</span>
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>updateStatus(<span style="color:#d14">&#34;Mirrored Horizontally&#34;</span> \
            <span style="color:#000;font-weight:bold">if</span> on <span style="color:#000;font-weight:bold">else</span> <span style="color:#d14">&#34;Unmirrored Horizontally&#34;</span>)

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">editUnMirror</span>(<span style="color:#999">self</span>, on):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>mirroredhorizontally:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>editMirrorHorizontal(<span style="color:#999">False</span>)
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>mirroredvertically:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>editMirrorVertical(<span style="color:#999">False</span>)

<span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">editZoom</span>(<span style="color:#999">self</span>):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#000;font-weight:bold">return</span>
    percent, ok <span style="color:#000;font-weight:bold">=</span> QInputDialog<span style="color:#000;font-weight:bold">.</span>getInteger(<span style="color:#999">self</span>,
            <span style="color:#d14">&#34;Image Changer - Zoom&#34;</span>, <span style="color:#d14">&#34;Percent:&#34;</span>,
            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>value(), <span style="color:#099">1</span>, <span style="color:#099">400</span>)
    <span style="color:#000;font-weight:bold">if</span> ok:
        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>setValue(percent)</code></pre></div>
<p><code>QInputDialog</code>提供了一些其它方便的静态方法，<code>getDouble()</code>，<code>getItem()</code>，<code>getText()</code>。
所有这些方法返回一个tuple，包含一个指示用户是否输入的bool值和一个合法值。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">showImage</span>(<span style="color:#999">self</span>, percent<span style="color:#000;font-weight:bold">=</span><span style="color:#999">None</span>):
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>isNull():
        <span style="color:#000;font-weight:bold">return</span>
    <span style="color:#000;font-weight:bold">if</span> percent <span style="color:#000;font-weight:bold">is</span> <span style="color:#999">None</span>:
        percent <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>zoomSpinBox<span style="color:#000;font-weight:bold">.</span>value()
    factor <span style="color:#000;font-weight:bold">=</span> percent <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">100.0</span>
    width <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>width() <span style="color:#000;font-weight:bold">*</span> factor
    height <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>height() <span style="color:#000;font-weight:bold">*</span> factor
    image <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>image<span style="color:#000;font-weight:bold">.</span>scaled(width, height, Qt<span style="color:#000;font-weight:bold">.</span>KeepAspectRatio)
    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>imageLabel<span style="color:#000;font-weight:bold">.</span>setPixmap(QPixmap<span style="color:#000;font-weight:bold">.</span>fromImage(image))</code></pre></div>
<p>根据PyQt的文档，<code>QPixmap</code>对屏幕显示做了优化，而<code>QImage</code>对编辑做了优化，因此我们用它保存图像数据。</p>
<h1 id="处理帮助动作">处理帮助动作</h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">helpAbout</span>(<span style="color:#999">self</span>):
    QMessageBox<span style="color:#000;font-weight:bold">.</span>about(<span style="color:#999">self</span>, <span style="color:#d14">&#34;About Image Changer&#34;</span>,
            <span style="color:#d14">&#34;&#34;&#34;&lt;b&gt;Image Changer&lt;/b&gt; v </span><span style="color:#d14">%s</span><span style="color:#d14">
</span><span style="color:#d14">            &lt;p&gt;Copyright &amp;copy; 2007 Qtrac Ltd. 
</span><span style="color:#d14">            All rights reserved.
</span><span style="color:#d14">            &lt;p&gt;This application can be used to perform
</span><span style="color:#d14">            simple image manipulations.
</span><span style="color:#d14">            &lt;p&gt;Python </span><span style="color:#d14">%s</span><span style="color:#d14"> - Qt </span><span style="color:#d14">%s</span><span style="color:#d14"> - PyQt </span><span style="color:#d14">%s</span><span style="color:#d14"> on </span><span style="color:#d14">%s</span><span style="color:#d14">&#34;&#34;&#34;</span> <span style="color:#000;font-weight:bold">%</span> (
            __version__, platform<span style="color:#000;font-weight:bold">.</span>python_version(),
            QT_VERSION_STR, PYQT_VERSION_STR, platform<span style="color:#000;font-weight:bold">.</span>system()))</code></pre></div>
<p><code>QMessageBox.about()</code>静态方法弹出一个给定标题和文本的只有OK按钮的模式对话框，其文本可以是HTML。</p>
<h1 id="总结">总结</h1>
<p>主窗口风格的程序由<code>QMainWindow</code>子类创建，其窗口只有一个单一的部件作为中央部件。</p>
<p>动作用来表示程序向用户提供的功能。这些动作保存在<code>QAction</code>对象中，包含文本(用于菜单)，图标(用于菜单
和工具栏)，工具栏提示和状态栏提示，以及所连接的槽。
通常所有的动作都会添加进菜单，而只有经常使用的一些加入工具栏。</p>
<p>动作，动作组和悬浮窗必须显式提供一个父亲，比如主窗口，以保证在合适的时候能被销毁。</p>
<p>程序通常使用资源(小文件，比如图标，和数据文件)，PyQt的资源机制使得访问和使用资源非常简单。使用
<code>pyrcc4</code>将资源文件编程Python模块，再导入程序使用。</p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://gitop.cc">招财猫</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://gitop.cc/posts/pyqt-6/">https://gitop.cc/posts/pyqt-6/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/pyqt-5/">PyQt编程第5章 对话框</a></li>
        
        <li><a href="/posts/pyqt-4/">PyQt编程第4章 GUI编程介绍</a></li>
        
        <li><a href="/posts/cpp-primer-15/">第15章 面向对象编程</a></li>
        
        <li><a href="/posts/cpp-primer-14/">第14章 重载操作和转换</a></li>
        
        <li><a href="/posts/syntax/">Markdown语法</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://gitop.cc/tags/Python'>Python</a></li>
                
            </ul>
            
        </div>
    </article>
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "your github repo"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://gitop.cc/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://gitop.cc">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://gitop.cc/posts/scrapy-fundamental/" title="Scrapy爬虫基础">Scrapy爬虫基础</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/xpath/" title="XPath教程">XPath教程</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/refactoring-testing-debugging/" title="重构、测试和调试">重构、测试和调试</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/collection-api-enhancements/" title="Collection API增强">Collection API增强</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/parallel-data-processing-and-performance/" title="并行数据处理和性能">并行数据处理和性能</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/collecting-data-with-streams/" title="使用流收集数据">使用流收集数据</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/working-with-streams/" title="使用流">使用流</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/introducing-streams/" title="流介绍">流介绍</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/lambda-expressions/" title="Lambda表达式">Lambda表达式</a>
    </li>
    
    <li>
        <a href="https://gitop.cc/posts/git-multi-sshkey/" title="Git配置多个SSH-Key">Git配置多个SSH-Key</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li><a href="https://gitop.cc/categories/Crawler/">Crawler (1)</a></li>
    
    <li><a href="https://gitop.cc/categories/Database/">Database (12)</a></li>
    
    <li><a href="https://gitop.cc/categories/GUI/">GUI (5)</a></li>
    
    <li><a href="https://gitop.cc/categories/Gist/">Gist (1)</a></li>
    
    <li><a href="https://gitop.cc/categories/Language/">Language (23)</a></li>
    
    <li><a href="https://gitop.cc/categories/Linux/">Linux (3)</a></li>
    
    <li><a href="https://gitop.cc/categories/Network/">Network (4)</a></li>
    
    <li><a href="https://gitop.cc/categories/Tool/">Tool (4)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://gitop.cc/tags/C/">C</a>
    
    <a href="https://gitop.cc/tags/C&#43;&#43;/">C&#43;&#43;</a>
    
    <a href="https://gitop.cc/tags/CentOS/">CentOS</a>
    
    <a href="https://gitop.cc/tags/Docker/">Docker</a>
    
    <a href="https://gitop.cc/tags/Git/">Git</a>
    
    <a href="https://gitop.cc/tags/Greenplum/">Greenplum</a>
    
    <a href="https://gitop.cc/tags/Idea/">Idea</a>
    
    <a href="https://gitop.cc/tags/Java/">Java</a>
    
    <a href="https://gitop.cc/tags/Javascript/">Javascript</a>
    
    <a href="https://gitop.cc/tags/Markdown/">Markdown</a>
    
    <a href="https://gitop.cc/tags/MySQL/">MySQL</a>
    
    <a href="https://gitop.cc/tags/PostgreSQL/">PostgreSQL</a>
    
    <a href="https://gitop.cc/tags/ProjectEuler/">ProjectEuler</a>
    
    <a href="https://gitop.cc/tags/Python/">Python</a>
    
    <a href="https://gitop.cc/tags/Scrapy/">Scrapy</a>
    
    <a href="https://gitop.cc/tags/Ubuntu/">Ubuntu</a>
    
    <a href="https://gitop.cc/tags/XPath/">XPath</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://gitop.cc/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="https://gitop.cc">招财猫的博客 By 招财猫</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>