<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="PyQt编程第6章 主窗口">
<meta itemprop="description" content="创建一个主窗口 import os import platform import sys from PyQt4.QtCore import * from PyQt4.QtGui import * import helpform import newimagedlg import qrc_resources __version__ = &#34;1.0.0&#34; import的顺序：先Python标准模块，然后第三方模块(比如PyQt)，最后">


<meta itemprop="datePublished" content="2015-10-21T11:25:57&#43;00:00" />
<meta itemprop="dateModified" content="2015-10-21T11:25:57&#43;00:00" />
<meta itemprop="wordCount" content="5079">



<meta itemprop="keywords" content="Python," />
<meta property="og:title" content="PyQt编程第6章 主窗口" />
<meta property="og:description" content="创建一个主窗口 import os import platform import sys from PyQt4.QtCore import * from PyQt4.QtGui import * import helpform import newimagedlg import qrc_resources __version__ = &#34;1.0.0&#34; import的顺序：先Python标准模块，然后第三方模块(比如PyQt)，最后" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://gitop.cc/posts/pyqt-6/" />
<meta property="article:published_time" content="2015-10-21T11:25:57+00:00" />
<meta property="article:modified_time" content="2015-10-21T11:25:57+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PyQt编程第6章 主窗口"/>
<meta name="twitter:description" content="创建一个主窗口 import os import platform import sys from PyQt4.QtCore import * from PyQt4.QtGui import * import helpform import newimagedlg import qrc_resources __version__ = &#34;1.0.0&#34; import的顺序：先Python标准模块，然后第三方模块(比如PyQt)，最后"/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>PyQt编程第6章 主窗口</title>
	<link rel="stylesheet" href="http://gitop.cc/css/style.min.574d8c6248cc82ef15f1ad92df37a0e749a3d11c6d81e64dcc2ed1f90be506cc.css" integrity="sha256-V02MYkjMgu8V8a2S3zeg50mj0RxtgeZNzC7R+QvlBsw=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="http://gitop.cc">静心</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="http://gitop.cc/posts/">Posts</a>
				<a href="http://gitop.cc/tags/">Tags</a>
				<a href="http://gitop.cc/about/">About</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://github.com/opensvn" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="http://gitop.cc/posts/">Posts</a></li>
			<li><a href="http://gitop.cc/tags/">Tags</a></li>
			<li><a href="http://gitop.cc/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Oct 21, 2015</span></div>
				<h1>PyQt编程第6章 主窗口</h1>
			</header>
			<div class="content">
				

<h1 id="创建一个主窗口">创建一个主窗口<a href="#创建一个主窗口" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">helpform</span>
<span class="kn">import</span> <span class="nn">newimagedlg</span>
<span class="kn">import</span> <span class="nn">qrc_resources</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&#34;1.0.0&#34;</span></code></pre></div>

<p><code>import</code>的顺序：先Python标准模块，然后第三方模块(比如PyQt)，最后自己定义的模块。
一个程序通常有一个版本字符串，按照惯例称为<code>__version__</code>。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirroredvertically</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirroredhorizontally</span> <span class="o">=</span> <span class="bp">False</span></code></pre></div>

<p><code>QImage</code>并不是继承自<code>QObject</code>，不需要<code>parent</code>。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ActionsContextMenu</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">)</span></code></pre></div>

<p>PyQt提供许多种方式创建右键菜单，我们使用最简单和最常见的方式。首先必须设置部件的右键菜单策略，然后
给部件添加一些操作。</p>

<p>和对话框不一样，在一个主窗口风格的程序中，只有一个中心部件，尽管它可以是组合而成的。我么只需要调用
<code>setCentralWidget</code>就好了。</p>

<p>在PyQt中，悬浮窗口是<code>QDockWidget</code>类的实例。我们可以添加一个部件到悬浮部件。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">logDockWidget</span> <span class="o">=</span> <span class="n">QDockWidget</span><span class="p">(</span><span class="s2">&#34;Log&#34;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="n">logDockWidget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&#34;LogDockWidget&#34;</span><span class="p">)</span>
<span class="n">logDockWidget</span><span class="o">.</span><span class="n">setAllowedAreas</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftDockWidgetArea</span><span class="o">|</span>
                              <span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">()</span>
<span class="n">logDockWidget</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addDockWidget</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">,</span> <span class="n">logDockWidget</span><span class="p">)</span></code></pre></div>

<p>悬浮部件不会被加入布局，所以当创建它们时，需要指定<code>parent</code>。</p>

<p>每一个PyQt对象都可以指定一个对象名字。PyQt使用对象名字区分悬浮部件。
<code>setFeatures</code>方法控制悬浮部件能否移动，悬浮或关闭。</p>

<p><code>QPrinter</code>对象管理打印机操作。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">sizeLabel</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">sizeLabel</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">StyledPanel</span><span class="o">|</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Sunken</span><span class="p">)</span>
<span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span>
<span class="n">status</span><span class="o">.</span><span class="n">setSizeGripEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">status</span><span class="o">.</span><span class="n">addPermanentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizeLabel</span><span class="p">)</span>
<span class="n">status</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&#34;Ready&#34;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span></code></pre></div>

<p>状态栏由<code>QMainWindow</code>第一次调用<code>statusBar</code>创建。<code>showMessage</code>在状态栏显示信息直到另一个
<code>showMessage</code>被调用或<code>clearMessage</code>被调用。</p>

<h1 id="动作和键序列">动作和键序列<a href="#动作和键序列" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>PyQt用<code>QAction</code>封装用户动作。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fileNewAction</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&#34;images/filenew.png&#34;</span><span class="p">),</span> <span class="s2">&#34;&amp;New&#34;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="n">fileNewAction</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="o">.</span><span class="n">New</span><span class="p">)</span>
<span class="n">helpText</span> <span class="o">=</span> <span class="s2">&#34;Create a new image&#34;</span>
<span class="n">fileNewAction</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">helpText</span><span class="p">)</span>
<span class="n">fileNewAction</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">helpText</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">fileNewAction</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&#34;triggered()&#34;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileNew</span><span class="p">)</span></code></pre></div>

<p>许多键序列都标准化了，有些甚至跨平台。比如<code>Ctrl+N</code>对应新建，<code>Ctrl+S</code>对应保存。
<code>QKeySequence</code>提供标准化的键序列常量，如<code>QKeySequence.New</code>，<code>QKeySequence.Paste</code>
对于还未标准化的键序列(或向后兼容的原因)，可以用字符串作为快捷键，setShortcut(&ldquo;Ctrl+Q&rdquo;)。</p>

<p>注意我们给<code>QAction</code>一个self作为父亲。每一个<code>QObject</code>子类(除了顶级窗口)都有一个父亲。</p>

<table>
<thead>
<tr>
<th>语法</th>
<th align="left">描述</th>
</tr>
</thead>

<tbody>
<tr>
<td>a.data()</td>
<td align="left">返回QAction a的数据，作为QVariant</td>
</tr>

<tr>
<td>a.setData(v)</td>
<td align="left">设置QAction a的数据为QVariant v</td>
</tr>

<tr>
<td>a.isChecked()</td>
<td align="left">返回True如果QAction a被确认过</td>
</tr>

<tr>
<td>a.setChecked(b)</td>
<td align="left">选与不选QAction a取决于bool b</td>
</tr>

<tr>
<td>a.isEnabled()</td>
<td align="left">返回True如果QAction a生效</td>
</tr>

<tr>
<td>a.setEnabled(b)</td>
<td align="left">生效或失效QAction a取决于bool b</td>
</tr>

<tr>
<td>a.setSeparator(b)</td>
<td align="left">设置QAction a为正常动作或分隔符取决于bool b</td>
</tr>

<tr>
<td>a.setShortcut(k)</td>
<td align="left">设置QAction a的快捷键为QKeySequence k</td>
</tr>

<tr>
<td>a.setStatusTip(s)</td>
<td align="left">设置QAction a的状态提示为string s</td>
</tr>

<tr>
<td>a.setText(s)</td>
<td align="left">设置QAction a的文本为string s</td>
</tr>

<tr>
<td>a.setToolTip(s)</td>
<td align="left">设置QAction a的工具提示为string s</td>
</tr>

<tr>
<td>a.setWhatsThis(s)</td>
<td align="left">设置QAction a的What&rsquo;s This?文本为string s</td>
</tr>

<tr>
<td>a.toggled(b)</td>
<td align="left">这个信号被发射当QAction a的选中状态改变；bool b为True如果动作被选中</td>
</tr>

<tr>
<td>a.triggered(b)</td>
<td align="left">这个信号被发射QAction a被调用；bool b为True如果a被选中</td>
</tr>
</tbody>
</table>

<p>一旦创建了动作，我们就能把它添加到菜单或工具栏。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fileMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">fileNewAction</span><span class="p">)</span>
<span class="n">fileToolbar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">fileNewAction</span><span class="p">)</span></code></pre></div>

<h1 id="资源文件">资源文件<a href="#资源文件" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>创建一个资源模块需要做两件事情。第一创建一个<code>.qrc</code>的文件，包含程序详细的资源。然后运行<code>pyrcc4</code>
读取<code>.qrc</code>文件生成资源模块。<code>.qrc</code>是一个XML格式的文件。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">RCC</span><span class="o">&gt;&lt;</span><span class="n">RCC</span> <span class="n">version</span><span class="o">=</span><span class="s2">&#34;1.0&#34;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">qresource</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">file</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&#34;filenew.png&#34;</span><span class="o">&gt;</span><span class="n">images</span><span class="o">/</span><span class="n">filenew</span><span class="o">.</span><span class="n">png</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">file</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&#34;fileopen.png&#34;</span><span class="o">&gt;</span><span class="n">images</span><span class="o">/</span><span class="n">fileopen</span><span class="o">.</span><span class="n">png</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
<span class="err">···</span>
<span class="o">&lt;</span><span class="nb">file</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&#34;icon.png&#34;</span><span class="o">&gt;</span><span class="n">images</span><span class="o">/</span><span class="n">icon</span><span class="o">.</span><span class="n">png</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">file</span><span class="o">&gt;</span><span class="n">help</span><span class="o">/</span><span class="n">editmenu</span><span class="o">.</span><span class="n">html</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">file</span><span class="o">&gt;</span><span class="n">help</span><span class="o">/</span><span class="n">filemenu</span><span class="o">.</span><span class="n">html</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">file</span><span class="o">&gt;</span><span class="n">help</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">qresource</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">RCC</span><span class="o">&gt;</span></code></pre></div>

<p>现在使用一个新建文件的图片，我们可以写成<code>QIcon(&quot;:/images/filenew.png&quot;)</code>，多亏了别名，
也可以缩写为<code>QIcon(&quot;:/filenew.png&quot;)</code>。前面的:/告诉PyQt文件是一个资源。在使用资源之前，
必须生成资源模块并导入进程序。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">C</span><span class="p">:</span>\<span class="n">pyqt</span>\<span class="n">chap06</span><span class="o">&gt;</span><span class="n">pyrcc4</span> <span class="o">-</span><span class="n">o</span> <span class="n">qrc_resources</span><span class="o">.</span><span class="n">py</span> <span class="n">resources</span><span class="o">.</span><span class="n">qrc</span></code></pre></div>

<h1 id="创建和使用动作">创建和使用动作<a href="#创建和使用动作" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>一个辅助创建动作的函数：</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">createAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shortcut</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">tip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="s2">&#34;triggered()&#34;</span><span class="p">):</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">icon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&#34;:/</span><span class="si">%s</span><span class="s2">.png&#34;</span> <span class="o">%</span> <span class="n">icon</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">shortcut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">shortcut</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span> <span class="n">slot</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">checkable</span><span class="p">:</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span>
<span class="n">fileNewAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createAction</span><span class="p">(</span><span class="s2">&#34;&amp;New...&#34;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileNew</span><span class="p">,</span>
        <span class="n">QKeySequence</span><span class="o">.</span><span class="n">New</span><span class="p">,</span> <span class="s2">&#34;filenew&#34;</span><span class="p">,</span> <span class="s2">&#34;Create an image file&#34;</span><span class="p">)</span>
<span class="n">fileQuitAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createAction</span><span class="p">(</span><span class="s2">&#34;&amp;Quit&#34;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">,</span>
        <span class="s2">&#34;Ctrl+Q&#34;</span><span class="p">,</span> <span class="s2">&#34;filequit&#34;</span><span class="p">,</span> <span class="s2">&#34;Close the application&#34;</span><span class="p">)</span>
<span class="n">editZoomAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createAction</span><span class="p">(</span><span class="s2">&#34;&amp;Zoom...&#34;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editZoom</span><span class="p">,</span>
        <span class="s2">&#34;Alt+Z&#34;</span><span class="p">,</span> <span class="s2">&#34;editzoom&#34;</span><span class="p">,</span> <span class="s2">&#34;Zoom the image&#34;</span><span class="p">)</span>
<span class="n">editInvertAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createAction</span><span class="p">(</span><span class="s2">&#34;&amp;Invert&#34;</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editInvert</span><span class="p">,</span> <span class="s2">&#34;Ctrl+I&#34;</span><span class="p">,</span> <span class="s2">&#34;editinvert&#34;</span><span class="p">,</span>
        <span class="s2">&#34;Invert the image&#39;s colors&#34;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&#34;toggled(bool)&#34;</span><span class="p">)</span></code></pre></div>

<p><code>toggled(bool)</code>信号不仅告诉我们动作被调用，而且返回动作是否被选中。</p>

<p>一个动作组管理一组动作使得任何时候只有一个动作被选中。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">mirrorGroup</span> <span class="o">=</span> <span class="n">QActionGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="n">editUnMirrorAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createAction</span><span class="p">(</span><span class="s2">&#34;&amp;Unmirror&#34;</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editUnMirror</span><span class="p">,</span> <span class="s2">&#34;Ctrl+U&#34;</span><span class="p">,</span> <span class="s2">&#34;editunmirror&#34;</span><span class="p">,</span>
        <span class="s2">&#34;Unmirror the image&#34;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&#34;toggled(bool)&#34;</span><span class="p">)</span>
<span class="n">mirrorGroup</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">editUnMirrorAction</span><span class="p">)</span>
<span class="n">editUnMirrorAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></code></pre></div>

<p>可选中的动作默认是未选中状态，所以在动作组中初始时必须选择一个为选中状态。</p>

<p>虽然所有动作已经创建好，但是它们还不能工作。只有当动作加进菜单或工具栏才能起作用。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">editMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&#34;&amp;Edit&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="n">editMenu</span><span class="p">,</span> <span class="p">(</span><span class="n">editInvertAction</span><span class="p">,</span>
        <span class="n">editSwapRedAndBlueAction</span><span class="p">,</span> <span class="n">editZoomAction</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">addActions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span></code></pre></div>

<p>也可以使用<code>QWidget.addActions</code>添加多个动作到菜单或工具栏。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">mirrorMenu</span> <span class="o">=</span> <span class="n">editMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&#34;:/editmirror.png&#34;</span><span class="p">),</span>
                              <span class="s2">&#34;&amp;Mirror&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="n">mirrorMenu</span><span class="p">,</span> <span class="p">(</span><span class="n">editUnMirrorAction</span><span class="p">,</span>
        <span class="n">editMirrorHorizontalAction</span><span class="p">,</span> <span class="n">editMirrorVerticalAction</span><span class="p">))</span></code></pre></div>

<p>子目录的创建和其它目录一样，不同的是使用<code>QMenu.addMenu</code>加进父目录。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&#34;&amp;File&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">fileMenuActions</span> <span class="o">=</span> <span class="p">(</span><span class="n">fileNewAction</span><span class="p">,</span> <span class="n">fileOpenAction</span><span class="p">,</span>
        <span class="n">fileSaveAction</span><span class="p">,</span> <span class="n">fileSaveAsAction</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">filePrintAction</span><span class="p">,</span> <span class="n">fileQuitAction</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&#34;aboutToShow()&#34;</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">updateFileMenu</span><span class="p">)</span>

<span class="n">fileToolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="s2">&#34;File&#34;</span><span class="p">)</span>
<span class="n">fileToolbar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&#34;FileToolBar&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="n">fileToolbar</span><span class="p">,</span> <span class="p">(</span><span class="n">fileNewAction</span><span class="p">,</span> <span class="n">fileOpenAction</span><span class="p">,</span>
                              <span class="n">fileSaveAsAction</span><span class="p">))</span></code></pre></div>

<p><code>addToolBar</code>创建一个<code>QToolBar</code>对象。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">editToolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="s2">&#34;Edit&#34;</span><span class="p">)</span>
<span class="n">editToolbar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&#34;EditToolBar&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="n">editToolbar</span><span class="p">,</span> <span class="p">(</span><span class="n">editInvertAction</span><span class="p">,</span>
        <span class="n">editSwapRedAndBlueAction</span><span class="p">,</span> <span class="n">editUnMirrorAction</span><span class="p">,</span>
        <span class="n">editMirrorVerticalAction</span><span class="p">,</span>
        <span class="n">editMirrorHorizontalAction</span><span class="p">))</span></code></pre></div>

<p>添加部件到工具栏都一样： 创建部件，配置好部件，连接信号，然后把部件添加到工具栏</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">setSuffix</span><span class="p">(</span><span class="s2">&#34; %&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&#34;Zoom the image&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">toolTip</span><span class="p">())</span>
<span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoFocus</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="p">,</span>
             <span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&#34;valueChanged(int)&#34;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">)</span>
<span class="n">editToolbar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="p">)</span></code></pre></div>

<p>之前有一行这样的代码：</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ActionsContextMenu</span><span class="p">)</span></code></pre></div>

<p>它告诉PyQt，如果动作被加进imageLabel部件，它们也被用作右键菜单。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">,</span> <span class="p">(</span><span class="n">editInvertAction</span><span class="p">,</span>
        <span class="n">editSwapRedAndBlueAction</span><span class="p">,</span> <span class="n">editUnMirrorAction</span><span class="p">,</span>
        <span class="n">editMirrorVerticalAction</span><span class="p">,</span> <span class="n">editMirrorHorizontalAction</span><span class="p">))</span></code></pre></div>

<p><code>QWidget</code>类有一个<code>addAction</code>方法，因此<code>QMenu</code>，<code>QMenuBar</code>，<code>QToolBar</code>都继承了这个方法。
尽管<code>QWidget</code>没有<code>addSeparator</code>方法，为了方便，<code>QMenu</code>，<code>QMenuBar</code>，<code>QToolBar</code>都提供了。
如果要添加一个分隔符到右键菜单，则必须添加一个分隔动作。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">separator</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="n">separator</span><span class="o">.</span><span class="n">setSeparator</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="n">editToolbar</span><span class="p">,</span> <span class="p">(</span><span class="n">editInvertAction</span><span class="p">,</span>
        <span class="n">editSwapRedAndBlueAction</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">editUnMirrorAction</span><span class="p">,</span>
        <span class="n">editMirrorVerticalAction</span><span class="p">,</span> <span class="n">editMirrorHorizontalAction</span><span class="p">))</span></code></pre></div>

<h1 id="恢复和保存主窗口状态">恢复和保存主窗口状态<a href="#恢复和保存主窗口状态" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setOrganizationName</span><span class="p">(</span><span class="s2">&#34;Qtrac Ltd.&#34;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setOrganizationDomain</span><span class="p">(</span><span class="s2">&#34;qtrac.eu&#34;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setApplicationName</span><span class="p">(</span><span class="s2">&#34;Image Changer&#34;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setWindowIcon</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&#34;:/icon.png&#34;</span><span class="p">))</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
    <span class="n">form</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></code></pre></div>

<p>函数main的第二行到第四行的主要作用就是程序配置的加载和保存。如果不传任何参数给<code>QSettings</code>对象，
则它会使用这三行代码设定的名字。这些名字使得程序配置保存在合适的地方，比如Windows的注册表，Linux
的$HOME/.config</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">settings</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&#34;RecentFiles&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">toStringList</span><span class="p">()</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&#34;MainWindow/Size&#34;</span><span class="p">,</span>
                      <span class="n">QVariant</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">500</span><span class="p">)))</span><span class="o">.</span><span class="n">toSize</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="n">position</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&#34;MainWindow/Position&#34;</span><span class="p">,</span>
                          <span class="n">QVariant</span><span class="p">(</span><span class="n">QPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">toPoint</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">restoreState</span><span class="p">(</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&#34;MainWindow/State&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">toByteArray</span><span class="p">())</span>
<span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&#34;Image Changer&#34;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">updateFileMenu</span><span class="p">()</span>
<span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadInitialFile</span><span class="p">)</span></code></pre></div>

<p><code>QSettings.value()</code>返回一个<code>QVariant</code>，因此必须转换为我们期望的数据类型。
带2个参数形式的<code>value()</code>方法，第二个参数是默认值。</p>

<p><code>resize()</code>和<code>move()</code>并不会造成窗口抖动，因为这些操作是在窗口显示之前已经完成。
Qt4.2引入2个新的方法保存和恢复一个顶层窗口的几何位置。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">restoreGeometry</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&#34;Geometry&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">toByteArray</span><span class="p">())</span></code></pre></div>

<p><code>QMainWindow</code>类提供<code>restoreState()</code>和<code>saveState()</code>方法，来恢复自或保存到一个<code>QByteArray</code>。
它们只保存拥有唯一对象名的悬浮窗口的大小和位置以及工具栏的位置。</p>

<blockquote>
<p><strong>启动时做大量处理</strong>
如果我们需要在启动时做大量处理，比如加载许多大文件，我们经常用一个独立的加载方法来做此事。
想象一下，比如这个方法是loadInitialFiles()，加载许多大文件。则在show()和事件循环(exec_())
开始之前，用户将体验到一个非常长的启动延迟。
我们希望窗口尽可能快的出现，使用户知道启动成功，并能够看到长时间运行的进程。这些通过0延迟的
singleShot计时器完成。因为它并不会立即执行连接的槽，相反它简单地将槽放到事件队列就返回。
0延迟计时器意思是，“当事件队列没有其它事件处理时处理这个事件”</p>
</blockquote>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">loadInitialFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&#34;LastFile&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">and</span> <span class="n">QFile</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadFile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code></pre></div>

<p>如果用户试图关闭程序，不管什么方式，<code>closeEvent()</code>被调用。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">okToContinue</span><span class="p">():</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QVariant</span><span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span> \
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">QVariant</span><span class="p">()</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&#34;LastFile&#34;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">recentFiles</span> <span class="o">=</span> <span class="n">QVariant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span><span class="p">)</span> \
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span> <span class="k">else</span> <span class="n">QVariant</span><span class="p">()</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&#34;RecentFiles&#34;</span><span class="p">,</span> <span class="n">recentFiles</span><span class="p">)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&#34;MainWindow/Size&#34;</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&#34;MainWindow/Position&#34;</span><span class="p">,</span>
                <span class="n">QVariant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()))</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&#34;MainWindow/State&#34;</span><span class="p">,</span>
                <span class="n">QVariant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveState</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span></code></pre></div>

<table>
<thead>
<tr>
<th>语法</th>
<th align="left">描述</th>
</tr>
</thead>

<tbody>
<tr>
<td>m.addDockWidget(a, d)</td>
<td align="left">在QMainWindow m中添加QDockWidget d到Qt.QDockWidgetArea a</td>
</tr>

<tr>
<td>m.addToolBar(s)</td>
<td align="left">添加并返回一个名叫string s的QToolBar</td>
</tr>

<tr>
<td>m.menuBar()</td>
<td align="left">返回QMainWindow m的QMenuBar(第一次调用创建目录)</td>
</tr>

<tr>
<td>m.restoreGeometry(ba)</td>
<td align="left">根据QByteArray ba恢复QMainWindow m的位置和大小(Qt4.3)</td>
</tr>

<tr>
<td>m.restoreState(ba)</td>
<td align="left">根据QByteArray ba恢复QMainWindow m的悬浮窗和工具栏的状态</td>
</tr>

<tr>
<td>m.saveGeometry()</td>
<td align="left">返回封装在QByteArray中QMainWindow m的位置和大小(Qt4.3)</td>
</tr>

<tr>
<td>m.saveState()</td>
<td align="left">返回封装在QByteArray中QMainWindow m的悬浮窗和工具栏的状态</td>
</tr>

<tr>
<td>m.setCentralWidget(w)</td>
<td align="left">设置QMainWindow m的中央部件为QWidget w</td>
</tr>

<tr>
<td>m.statusBar()</td>
<td align="left">返回QMainWindow的QStatusBar(第一次调用创建状态栏)</td>
</tr>

<tr>
<td>m.setWindowIcon(i)</td>
<td align="left">设置QMainWindow m的图标为QIcon i；这个方法继承自QWidget</td>
</tr>

<tr>
<td>m.setWindowTitle(s)</td>
<td align="left">设置QMainWindow m的标题为string s；这个方法继承自QWidget</td>
</tr>
</tbody>
</table>

<p>如果我们使用Qt4，使用<code>QWidget.restoreGeometry()</code>恢复窗口的几何位置，那么我们可以如此保存几何状态：</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&#34;Geometry&#34;</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveGeometry</span><span class="p">()))</span></code></pre></div>

<p>使用这种方法，不需要单独保存主窗口的大小和位置。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">okToContinue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span><span class="p">:</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="s2">&#34;Image Changer - Unsaved Changes&#34;</span><span class="p">,</span>
                    <span class="s2">&#34;Save unsaved changes?&#34;</span><span class="p">,</span>
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="o">|</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="o">|</span>
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileSave</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span></code></pre></div>

<p>有些开发者使用<code>QMessageBox.Save</code>和<code>QMessageBox.Discard</code>。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">updateFileMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileMenuActions</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">QString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">None</span>
    <span class="n">recentFiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="n">current</span> <span class="ow">and</span> <span class="n">QFile</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
            <span class="n">recentFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">recentFiles</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">recentFiles</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&#34;:/icon.png&#34;</span><span class="p">),</span> <span class="s2">&#34;&amp;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QFileInfo</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">fileName</span><span class="p">()),</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QVariant</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&#34;triggered()&#34;</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">loadFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fileMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileMenuActions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></code></pre></div>

<blockquote>
<p><strong>QMessageBox的静态方法</strong>
QMessageBox类提供多个方便的静态方法，这些方法弹出一个有合适图标和按钮的模式对话框。
最常用的方法为critical()，information()，question()和waring()。这些方法携带参数
父类部件，窗口标题，消息文本(可以是纯文本或HTML)，0个或多个按钮。如果未指定按钮，则为OK按钮。
Qt4.0和Qt4.1中，OK按钮或Yes按钮位或QMessageBox.Default，Cancel按钮或No按钮位或
  QMessageBox.Escape很常见。
    reply = QMessageBox.question(self,
            &ldquo;Image Changer - Unsaved Changes&rdquo;, &ldquo;Save unsaved changes?&rdquo;,
            QMessageBox.Yes|QMessageBox.Default,
            QMessageBox.No|QMessageBox.Escape)
4.2中则自动绑定默认动作到相应的按钮上。
如果我们想创建自定义的消息框，可以创建一个QMessageBox实例，然后使用QMessageBox.addButton()
QMessageBox.setIcon()添加按钮，再调用QMessageBox.exec_()弹出消息框。</p>
</blockquote>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">addRecentFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span><span class="o">.</span><span class="n">takeLast</span><span class="p">()</span></code></pre></div>

<h1 id="处理文件动作">处理文件动作<a href="#处理文件动作" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fileNew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">okToContinue</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="n">dialog</span> <span class="o">=</span> <span class="n">newimagedlg</span><span class="o">.</span><span class="n">NewImageDlg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRecentFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resetableActions</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">image</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizeLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%d</span><span class="s2"> x </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">(</span><span class="s2">&#34;Created new image&#34;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">updateStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">listWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&#34;Image Changer - </span><span class="si">%s</span><span class="s2">[*]&#34;</span> <span class="o">%</span> \
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&#34;Image Changer - Unnamed[*]&#34;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&#34;Image Changer[*]&#34;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setWindowModified</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirty</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fileOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">okToContinue</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="nb">dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s2">&#34;.&#34;</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;*.</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> \
               <span class="k">for</span> <span class="n">format</span> <span class="ow">in</span> <span class="n">QImageReader</span><span class="o">.</span><span class="n">supportedImageFormats</span><span class="p">()]</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="s2">&#34;Image Changer - Choose Image&#34;</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span>
                        <span class="s2">&#34;Image files (</span><span class="si">%s</span><span class="s2">)&#34;</span> <span class="o">%</span> <span class="s2">&#34; &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formats</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadFile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code></pre></div>

<p><code>QFileDialog.getOpenFileName()</code>返回一个<code>QString</code>保存文件名的绝对路径，或者返回空。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">fname</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="s2">&#34;</span><span class="si">%s</span><span class="s2"> - Choose Image&#34;</span> <span class="o">%</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">applicationName</span><span class="p">(),</span>
                <span class="nb">dir</span><span class="p">,</span> <span class="s2">&#34;Image files (</span><span class="si">%s</span><span class="s2">)&#34;</span> <span class="o">%</span> <span class="s2">&#34; &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formats</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">loadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">QAction</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">okToContinue</span><span class="p">():</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;Failed to read </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">fname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addRecentFile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resetableActions</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizeLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%d</span><span class="s2"> x </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">image</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">()))</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;Loaded </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fileSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileSaveAs</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">(</span><span class="s2">&#34;Saved as </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">(</span><span class="s2">&#34;Failed to save </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fileSaveAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s2">&#34;.&#34;</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;*.</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> \
               <span class="k">for</span> <span class="n">format</span> <span class="ow">in</span> <span class="n">QImageWriter</span><span class="o">.</span><span class="n">supportedImageFormats</span><span class="p">()]</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="s2">&#34;Image Changer - Save Image&#34;</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span>
                    <span class="s2">&#34;Image files (</span><span class="si">%s</span><span class="s2">)&#34;</span> <span class="o">%</span> <span class="s2">&#34; &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formats</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&#34;.&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">+=</span> <span class="s2">&#34;.png&#34;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRecentFile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileSave</span><span class="p">()</span></code></pre></div>

<p>QFileDialog.getSaveFileName()提示用户提供一个文件名用来保存当前文件。</p>

<h1 id="处理编辑动作">处理编辑动作<a href="#处理编辑动作" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">editInvert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">invertPixels</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">(</span><span class="s2">&#34;Inverted&#34;</span> <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="s2">&#34;Uninverted&#34;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">editMirrorHorizontal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">mirrored</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mirroredhorizontally</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirroredhorizontally</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">(</span><span class="s2">&#34;Mirrored Horizontally&#34;</span> \
            <span class="k">if</span> <span class="n">on</span> <span class="k">else</span> <span class="s2">&#34;Unmirrored Horizontally&#34;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">editUnMirror</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirroredhorizontally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editMirrorHorizontal</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirroredvertically</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editMirrorVertical</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">editZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="n">percent</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInteger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="s2">&#34;Image Changer - Zoom&#34;</span><span class="p">,</span> <span class="s2">&#34;Percent:&#34;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span></code></pre></div>

<p><code>QInputDialog</code>提供了一些其它方便的静态方法，<code>getDouble()</code>，<code>getItem()</code>，<code>getText()</code>。
所有这些方法返回一个tuple，包含一个指示用户是否输入的bool值和一个合法值。</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">showImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">percent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">percent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">percent</span> <span class="o">/</span> <span class="mf">100.0</span>
    <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">scaled</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">image</span><span class="p">))</span></code></pre></div>

<p>根据PyQt的文档，<code>QPixmap</code>对屏幕显示做了优化，而<code>QImage</code>对编辑做了优化，因此我们用它保存图像数据。</p>

<h1 id="处理帮助动作">处理帮助动作<a href="#处理帮助动作" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">helpAbout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">about</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&#34;About Image Changer&#34;</span><span class="p">,</span>
            <span class="s2">&#34;&#34;&#34;&lt;b&gt;Image Changer&lt;/b&gt; v </span><span class="si">%s</span><span class="s2">
</span><span class="s2">            &lt;p&gt;Copyright &amp;copy; 2007 Qtrac Ltd. 
</span><span class="s2">            All rights reserved.
</span><span class="s2">            &lt;p&gt;This application can be used to perform
</span><span class="s2">            simple image manipulations.
</span><span class="s2">            &lt;p&gt;Python </span><span class="si">%s</span><span class="s2"> - Qt </span><span class="si">%s</span><span class="s2"> - PyQt </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">__version__</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">(),</span>
            <span class="n">QT_VERSION_STR</span><span class="p">,</span> <span class="n">PYQT_VERSION_STR</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()))</span></code></pre></div>

<p><code>QMessageBox.about()</code>静态方法弹出一个给定标题和文本的只有OK按钮的模式对话框，其文本可以是HTML。</p>

<h1 id="总结">总结<a href="#总结" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>主窗口风格的程序由<code>QMainWindow</code>子类创建，其窗口只有一个单一的部件作为中央部件。</p>

<p>动作用来表示程序向用户提供的功能。这些动作保存在<code>QAction</code>对象中，包含文本(用于菜单)，图标(用于菜单
和工具栏)，工具栏提示和状态栏提示，以及所连接的槽。
通常所有的动作都会添加进菜单，而只有经常使用的一些加入工具栏。</p>

<p>动作，动作组和悬浮窗必须显式提供一个父亲，比如主窗口，以保证在合适的时候能被销毁。</p>

<p>程序通常使用资源(小文件，比如图标，和数据文件)，PyQt的资源机制使得访问和使用资源非常简单。使用
<code>pyrcc4</code>将资源文件编程Python模块，再导入程序使用。</p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="http://gitop.cc/tags/python">Python</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>5079 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2015-10-21 19:25 &#43;0800</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="http://gitop.cc/posts/project-euler-1/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Project Euler Problem 1</span>
			</a>
			<a class="prev-post" href="http://gitop.cc/posts/pyqt-5/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>PyQt编程第5章 对话框</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="http://gitop.cc">gitop</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="http://gitop.cc/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="http://gitop.cc/js/main.min.35ccbf1cdceb91e4c64c06b5d009d6e2977fafe56beda7762febd4e67528d2ac.js" integrity="sha256-Ncy/HNzrkeTGTAa10AnW4pd/r+Vr7ad2L+vU5nUo0qw="></script>

</body>

</html>
