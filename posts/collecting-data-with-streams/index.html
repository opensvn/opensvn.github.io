<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>使用流收集数据 | 招财猫的博客</title>
    <meta property="og:title" content="使用流收集数据 - 招财猫的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2019-07-23T13:04:54&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2019-07-23T13:04:54&#43;08:00'>
        
    <meta name="Keywords" content="C,C&#43;&#43;,Python,Golang">
    <meta name="description" content="使用流收集数据">
        
    <meta name="author" content="招财猫">
    <meta property="og:url" content="http://gitop.cc/posts/collecting-data-with-streams/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-4031353640611810",
        enable_page_level_ads: true
    });
    </script>
    


    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://gitop.cc">
                        招财猫的博客
                    </a>
                
                <p class="description">专注于C&#43;&#43;、Python、Golang</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="http://gitop.cc">首页</a>
                    
                    <a  href="http://gitop.cc/archives/" title="归档">归档</a>
                    
                    <a  href="http://gitop.cc/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#归纳总结">归纳总结</a>
      <ul>
        <li><a href="#查找最大和最小值">查找最大和最小值</a></li>
        <li><a href="#总结">总结</a></li>
        <li><a href="#连接字符串">连接字符串</a></li>
        <li><a href="#通用归纳总结">通用归纳总结</a></li>
      </ul>
    </li>
    <li><a href="#分组">分组</a>
      <ul>
        <li><a href="#操作分组元素">操作分组元素</a></li>
        <li><a href="#多级分组">多级分组</a></li>
        <li><a href="#在子分组中收集数据">在子分组中收集数据</a></li>
      </ul>
    </li>
    <li><a href="#分区">分区</a>
      <ul>
        <li><a href="#advantages-of-partitioning">Advantages of partitioning</a></li>
        <li><a href="#将数字划分为素数和非素数">将数字划分为素数和非素数</a></li>
      </ul>
    </li>
    <li><a href="#collector接口">Collector接口</a>
      <ul>
        <li><a href="#理解collector接口声明的方法">理解Collector接口声明的方法</a></li>
      </ul>
    </li>
    <li><a href="#开发自己的收集器">开发自己的收集器</a>
      <ul>
        <li><a href="#只除质数">只除质数</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">使用流收集数据</h1>
        </header>
        <date class="post-meta meta-date">
            2019年7月23日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='http://gitop.cc/categories/Language'>Language</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>假设有一个事务列表，你希望根据货币对它们进行分组。在Java 8之前，即使是这样一个简单的例子也很难实现，如下所示：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Currency<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Transaction<span style="color:#000;font-weight:bold">&gt;&gt;</span> transactionsByCurrencies <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
<span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Transaction transaction <span style="color:#000;font-weight:bold">:</span> transactions<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    Currency currency <span style="color:#000;font-weight:bold">=</span> transaction<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCurrency</span><span style="color:#000;font-weight:bold">();</span>
	List<span style="color:#000;font-weight:bold">&lt;</span>Transaction<span style="color:#000;font-weight:bold">&gt;</span> transactionsForCurrency <span style="color:#000;font-weight:bold">=</span> transactionsByCurrencies<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>currency<span style="color:#000;font-weight:bold">);</span>
	<span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>transactionsForCurrency <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
		transactionsForCurrency <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
		transactionsByCurrencies<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>currency<span style="color:#000;font-weight:bold">,</span> transactionsForCurrency<span style="color:#000;font-weight:bold">);</span>
	<span style="color:#000;font-weight:bold">}</span>
	transactionsForCurrency<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>transaction<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>在Java 8之后，仅用一条语句就可以获得完全相同的结果：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Currency<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Transaction<span style="color:#000;font-weight:bold">&gt;&gt;</span> transactionsByCurrencies <span style="color:#000;font-weight:bold">=</span> transactions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Transaction<span style="color:#000;font-weight:bold">::</span>getCurrency<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><p>Collector接口提供了三个主要功能：</p>
<ul>
<li>
<p>将流中的元素汇总为一个值</p>
</li>
<li>
<p>将元素进行分组</p>
</li>
<li>
<p>将元素进行分区</p>
</li>
</ul>
<h2 id="归纳总结">归纳总结</h2>
<p>Collector接口（collect方法的参数）通常用于需要将流的元素重新组织到集合中的情况。但更一般的情况是，Collector接口可以用于将流中的所有元素组合成一个结果时。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#458;font-weight:bold">long</span> howManyDishes <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>Collectors<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">counting</span><span style="color:#000;font-weight:bold">());</span>
</code></pre></div><p>也可以写成</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#458;font-weight:bold">long</span> howManyDishes <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">count</span><span style="color:#000;font-weight:bold">();</span>
</code></pre></div><h3 id="查找最大和最小值">查找最大和最小值</h3>
<p>你可以使用<code>Collectors.maxBy</code> 和<code>Collectors.minBy</code> 计算流中的最大值和最小值。它们的参数是<code>Comparator</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Comparator<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;</span> dishCaloriesComparator <span style="color:#000;font-weight:bold">=</span> Comparator<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">comparingInt</span><span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">);</span>
Optional<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;</span> mostCalorieDish <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>maxBy<span style="color:#000;font-weight:bold">(</span>dishCaloriesComparator<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><h3 id="总结">总结</h3>
<p>Collectors类提供了用于求和的特定工厂方法<code>Collectors.summingInt</code>，其参数是<code>ToIntFunction</code>，并返回一个Collector。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#458;font-weight:bold">int</span> totalCalories <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>summingInt<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><p><code>Collectors.summingLong</code> 和<code>Collectors.summingDouble</code> 方法类似用于计算long和double。<code>Collectors.averagingInt</code> ，<code>averagingLong</code> 和<code>averagingDouble</code> 用于计算一组值的平均值。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#458;font-weight:bold">double</span> avgCalories <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>averagingInt<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><p>有时候你想要获取更多统计信息，可以使用<code>Collectors.summarizingInt</code>。这个Collector将所有信息收集到<code>IntSummaryStatistics</code>类里面。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">IntSummaryStatistics menuStatistics <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>summarizingInt<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">));</span>
<span style="color:#998;font-style:italic">// IntSummaryStatistics{count=9, sum=4300, min=120, average=477.777778, max=800}
</span></code></pre></div><p>同样相应地有<code>summarizingLong</code>和<code>summarizingDouble</code>以及对应的类<code>LongSummaryStatistics</code>和<code>DoubleSummaryStatistics</code></p>
<h3 id="连接字符串">连接字符串</h3>
<p><code>Collectors.joining</code>将流中所有对象连接成一个字符串，调用每个对象的<code>toString</code>方法。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">String shortMenu <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">map</span><span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getName<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>joining<span style="color:#000;font-weight:bold">());</span>
</code></pre></div><p><code>Collectors.joining</code>的重载版本接受一个字符串用于间隔元素：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">String shortMenu <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">map</span><span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getName<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>joining<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;,&#34;</span><span style="color:#000;font-weight:bold">));</span>
</code></pre></div><h3 id="通用归纳总结">通用归纳总结</h3>
<p>到目前为止，我们讨论的所有Collector实际上都是<code>Collectors.reducing</code>方法的简便版。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#458;font-weight:bold">int</span> totalCalories <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>reducing<span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">,</span> Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>i<span style="color:#000;font-weight:bold">,</span> j<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> i <span style="color:#000;font-weight:bold">+</span> j<span style="color:#000;font-weight:bold">));</span>
Optional<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;</span> mostCalorieDish <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>reducing<span style="color:#000;font-weight:bold">((</span>d1<span style="color:#000;font-weight:bold">,</span> d2<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> d1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&gt;</span> d2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">?</span> d1 <span style="color:#000;font-weight:bold">:</span> d2<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><p>比如前面用到的<code>counting</code>定义如下：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> Collector<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">?,</span> Long<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">counting</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> reducing<span style="color:#000;font-weight:bold">(</span>0L<span style="color:#000;font-weight:bold">,</span> e <span style="color:#000;font-weight:bold">-&gt;</span> 1L<span style="color:#000;font-weight:bold">,</span> Long<span style="color:#000;font-weight:bold">::</span>sum<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>达到同样的效果，可以有多种方法，比如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#458;font-weight:bold">int</span> totalCalories <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">map</span><span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">reduce</span><span style="color:#000;font-weight:bold">(</span>Integer<span style="color:#000;font-weight:bold">::</span>sum<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#458;font-weight:bold">int</span> totalCalories <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">mapToInt</span><span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">sum</span><span style="color:#000;font-weight:bold">();</span>
</code></pre></div><h2 id="分组">分组</h2>
<p>数据库的一个常见操作是根据一个或多个属性将数据分组。Java 8中使用<code>groupingBy</code>达到相同的效果：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;</span> dishesByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><p>但是并不总是可以将方法引用用作分类函数，因为你可能希望使用比简单属性访问器更复杂的方法进行分类。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">enum</span> CaloricLevel <span style="color:#000;font-weight:bold">{</span>DIET<span style="color:#000;font-weight:bold">,</span> NORMAL<span style="color:#000;font-weight:bold">,</span> FAT<span style="color:#000;font-weight:bold">}</span>
Map<span style="color:#000;font-weight:bold">&lt;</span>CaloricLevel<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;</span> dishesByCaloricLevel <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>
    groupingBy<span style="color:#000;font-weight:bold">(</span>dish <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 400<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DIET</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 700<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NORMAL</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FAT</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}));</span>
</code></pre></div><h3 id="操作分组元素">操作分组元素</h3>
<p>假设你要按类型分组菜肴并在每个分组过滤热量大于500的菜肴，你可能会这样做：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;</span> caloricDishesByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">filter</span><span style="color:#000;font-weight:bold">(</span>dish <span style="color:#000;font-weight:bold">-&gt;</span> dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&gt;</span> 500<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><p>打印<code>caloricDishesByType</code>得到：</p>
<pre><code>{OTHER=[french fries, pizza], MEAT=[pork, beef]}
</code></pre><p>可以看到这个方法有一个问题，<code>FISH</code>分组不见了。为了解决这个问题，<code>Collectors.groupingBy </code>提供了一个重载的方法接受另一个Collector参数。如下所示：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;</span> caloricDishesByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> filtering<span style="color:#000;font-weight:bold">(</span>dish <span style="color:#000;font-weight:bold">-&gt;</span> dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&gt;</span> 500<span style="color:#000;font-weight:bold">,</span> toList<span style="color:#000;font-weight:bold">())));</span>
</code></pre></div><p><code>filtering </code>接受一个谓词过滤每个分组的元素，另外一个Collector用于重新分组过滤后的元素。</p>
<pre><code>{OTHER=[french fries, pizza], MEAT=[pork, beef], FISH=[]}
</code></pre><p>另一种常见的操作分组元素的方法是通过映射函数转换它们。<code>Collectors.mapping</code>接受一个Function和另一个Collector用于收集分组中被映射的元素：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;&gt;</span> dishNamesByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> mapping<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getName<span style="color:#000;font-weight:bold">,</span> toList<span style="color:#000;font-weight:bold">())));</span>
</code></pre></div><p><code>groupingBy</code>还可以和<code>flatMapping</code>结合使用。假设我们有如下数据：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;&gt;</span> dishTags <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pork&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;greasy&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;salty&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beef&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;salty&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;roasted&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;chicken&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;fried&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;crisp&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;french fries&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;greasy&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;fried&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;rice&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;light&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;natural&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;season fruit&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;fresh&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;natural&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pizza&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;tasty&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;salty&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;prawns&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;tasty&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;roasted&#34;</span><span style="color:#000;font-weight:bold">));</span>
dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;salmon&#34;</span><span style="color:#000;font-weight:bold">,</span> asList<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;delicious&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;fresh&#34;</span><span style="color:#000;font-weight:bold">));</span>
</code></pre></div><p>假如我们想要获取各类菜肴的标签，如下所示：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Set<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;&gt;</span> dishNamesByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> flatMapping<span style="color:#000;font-weight:bold">(</span>dish <span style="color:#000;font-weight:bold">-&gt;</span> dishTags<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">(),</span> toSet<span style="color:#000;font-weight:bold">())));</span>
</code></pre></div><h3 id="多级分组">多级分组</h3>
<p>带两个参数的<code>Collectors.groupingBy</code>可以用来执行两级分组，如下所示：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Map<span style="color:#000;font-weight:bold">&lt;</span>CaloricLevel<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> dishesByTypeCaloricLevel <span style="color:#000;font-weight:bold">=</span>
    menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>
        groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span>
            groupingBy<span style="color:#000;font-weight:bold">(</span>dish <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 400<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DIET</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 700<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NORMAL</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FAT</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">})</span>
        <span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">);</span>
</code></pre></div><p>多级分组操作可以扩展到任意层级，一个N级分组结果是一个N级Map。</p>
<h3 id="在子分组中收集数据">在子分组中收集数据</h3>
<p><code>groupingBy</code>的第二个参数可以是任意类型的Collector。比如<code>counting</code>用于计算每个分组的数量：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Long<span style="color:#000;font-weight:bold">&gt;</span> typesCount <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> counting<span style="color:#000;font-weight:bold">()));</span>
</code></pre></div><p>而且单个参数的<code>groupingBy(f)</code>实际上等价于<code>groupingBy(f, toList())</code>。再举一个例子，获取各类菜肴热量最高的菜：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Optional<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;</span> mostCaloricByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> maxBy<span style="color:#000;font-weight:bold">(</span>comparingInt<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">))));</span>
</code></pre></div><h4 id="将收集器结果调整为不同的类型">将收集器结果调整为不同的类型</h4>
<p>要使收集器返回的结果调整为不同的类型，可以使用Collectors.collectingAndThen factory`返回的Collector，如下面所示：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Dish<span style="color:#000;font-weight:bold">&gt;</span> mostCaloricByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span>
	collectingAndThen<span style="color:#000;font-weight:bold">(</span>maxBy<span style="color:#000;font-weight:bold">(</span>comparingInt<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">)),</span> Optional<span style="color:#000;font-weight:bold">::</span>get<span style="color:#000;font-weight:bold">)));</span>
</code></pre></div><h4 id="与groupingby一起使用的其他收集器示例">与groupingBy一起使用的其他收集器示例</h4>
<p>更一般地，传递给<code>groupingBy</code>方法第二个参数的收集器将用于对流中分类为同一组的所有元素执行进一步的归纳操作。比如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> totalCaloriesByType <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> summingInt<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">)));</span>
</code></pre></div><p>另外一个收集器是由<code>mapping</code>方法生成的。此方法接受两个参数：一个函数转换流中的元素，另一个收集器收集转换后的对象。如下：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Set<span style="color:#000;font-weight:bold">&lt;</span>CaloricLevel<span style="color:#000;font-weight:bold">&gt;&gt;</span> caloricLevelsByType <span style="color:#000;font-weight:bold">=</span>
    menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>
        groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> mapping<span style="color:#000;font-weight:bold">(</span>dish <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 400<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DIET</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 700<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NORMAL</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FAT</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">},</span> toSet<span style="color:#000;font-weight:bold">())));</span>
</code></pre></div><p>在上例中，我们不知道<code>toSet</code>会返回什么类型的Set。如果你想要返回指定的集合，可以是用<code>toCollection</code>：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> Set<span style="color:#000;font-weight:bold">&lt;</span>CaloricLevel<span style="color:#000;font-weight:bold">&gt;&gt;</span> caloricLevelsByType <span style="color:#000;font-weight:bold">=</span>
    menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>
        groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">,</span> mapping<span style="color:#000;font-weight:bold">(</span>dish <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 400<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DIET</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCalories</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;=</span> 700<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NORMAL</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">return</span> CaloricLevel<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">FAT</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">},</span> toCollection<span style="color:#000;font-weight:bold">(</span>HashSet<span style="color:#000;font-weight:bold">::</span><span style="color:#000;font-weight:bold">new</span><span style="color:#000;font-weight:bold">))));</span>
</code></pre></div><h2 id="分区">分区</h2>
<p>分区是分组的一种特殊情况：使用一个称为分区函数的谓词作为分类函数。分区函数返回布尔值这一事实意味着生成的分组映射将使用布尔值作为键类型，因此最多可以有两个不同的组——一个为true，一个为false。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;</span> partitionedMenu <span style="color:#000;font-weight:bold">=</span> menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>partitioningBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>isVegetarian<span style="color:#000;font-weight:bold">));</span>
</code></pre></div><h3 id="advantages-of-partitioning">Advantages of partitioning</h3>
<p>和分组一样，<code>partitioningBy</code>方法也有一个重载版本，可以向其传递第二个收集器，如下所示：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Type</span><span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> vegetarianDishesByType <span style="color:#000;font-weight:bold">=</span>
    menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>
        partitioningBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>isVegetarian<span style="color:#000;font-weight:bold">,</span> groupingBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getType<span style="color:#000;font-weight:bold">)));</span>

Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> Dish<span style="color:#000;font-weight:bold">&gt;</span> mostCaloricPartitionedByVegetarian <span style="color:#000;font-weight:bold">=</span>
    menu<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>
        partitioningBy<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>isVegetarian<span style="color:#000;font-weight:bold">,</span>
            collectingAndThen<span style="color:#000;font-weight:bold">(</span>maxBy<span style="color:#000;font-weight:bold">(</span>comparingInt<span style="color:#000;font-weight:bold">(</span>Dish<span style="color:#000;font-weight:bold">::</span>getCalories<span style="color:#000;font-weight:bold">)),</span>
                Optional<span style="color:#000;font-weight:bold">::</span>get<span style="color:#000;font-weight:bold">)));</span>
</code></pre></div><h3 id="将数字划分为素数和非素数">将数字划分为素数和非素数</h3>
<p>假设你想编写一个方法，接受一个整数n作为参数，并将前n个自然数划分为素数和非素数。但首先，你需要一个谓词判断一个整数是否是质数：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">isPrime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> candidate<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> IntStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">range</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">,</span> candidate<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">noneMatch</span><span style="color:#000;font-weight:bold">(</span>i <span style="color:#000;font-weight:bold">-&gt;</span> candidate <span style="color:#000;font-weight:bold">%</span> i <span style="color:#000;font-weight:bold">==</span> 0<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>下面是一个小小的优化：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">isPrime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> candidate<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#458;font-weight:bold">int</span> candidateRoot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span> Math<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sqrt</span><span style="color:#000;font-weight:bold">((</span><span style="color:#458;font-weight:bold">double</span><span style="color:#000;font-weight:bold">)</span> candidate<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">return</span> IntStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rangeClosed</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">,</span> candidateRoot<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">noneMatch</span><span style="color:#000;font-weight:bold">(</span>i <span style="color:#000;font-weight:bold">-&gt;</span> candidate <span style="color:#000;font-weight:bold">%</span> i <span style="color:#000;font-weight:bold">==</span> 0<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>现在就可以划分前n个整数是否是质数了：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">partitionPrimes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> n<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> IntStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rangeClosed</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">,</span> n<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">boxed</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>partitioningBy<span style="color:#000;font-weight:bold">(</span>candidate <span style="color:#000;font-weight:bold">-&gt;</span> isPrime<span style="color:#000;font-weight:bold">(</span>candidate<span style="color:#000;font-weight:bold">)));</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>下表是<code>Collectors</code>类中主要的静态工厂方法：</p>
<table>
<thead>
<tr>
<th>工厂方法</th>
<th>返回类型</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>toList</td>
<td>List&lt;T&gt;</td>
<td>将流中的元素放入List</td>
</tr>
<tr>
<td>toSet</td>
<td>Set&lt;T&gt;</td>
<td>将流中的元素放入Set，去除重复元素</td>
</tr>
<tr>
<td>toCollection</td>
<td>Collection&lt;T&gt;</td>
<td>将流中的元素放入指定的集合</td>
</tr>
<tr>
<td>counting</td>
<td>Long</td>
<td>统计流中元素个数</td>
</tr>
<tr>
<td>summingInt</td>
<td>Integer</td>
<td>对流中元素的整形属性求和</td>
</tr>
<tr>
<td>averagingInt</td>
<td>Double</td>
<td>计算流中元素的整形属性的平均值</td>
</tr>
<tr>
<td>summarizingInt</td>
<td>IntSummaryStatistics</td>
<td>收集流中元素的整形属性的统计数据</td>
</tr>
<tr>
<td>joining</td>
<td>String</td>
<td>连接流中元素调用toString方法产生的字符串</td>
</tr>
<tr>
<td>maxBy</td>
<td>Optional&lt;T&gt;</td>
<td>根据指定的Comparator返回流中最大的元素或Optional.empty()</td>
</tr>
<tr>
<td>minBy</td>
<td>Optional&lt;T&gt;</td>
<td>根据指定的Comparator返回流中最小的元素或Optional.empty()</td>
</tr>
<tr>
<td>reducing</td>
<td>归纳操作产生的类型</td>
<td>使用BinaryOperator依次将流中元素合并为一个值</td>
</tr>
<tr>
<td>collectingAndThen</td>
<td>转换函数返回的类型</td>
<td>包装另一个收集器并对其结果应用转换函数</td>
</tr>
<tr>
<td>groupingBy</td>
<td>Map&lt;K, List&lt;T&gt;&gt;</td>
<td>基于流中元素的属性作为键值分组元素</td>
</tr>
<tr>
<td>partitioningBy</td>
<td>Map&lt;Boolean, List&lt;T&gt;&gt;</td>
<td>基于谓词对流中的元素分区</td>
</tr>
</tbody>
</table>
<h2 id="collector接口">Collector接口</h2>
<p>Collector接口声明的方法如下：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">Collector</span><span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">,</span> A<span style="color:#000;font-weight:bold">,</span> R<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#000;font-weight:bold">{</span>
    Supplier<span style="color:#000;font-weight:bold">&lt;</span>A<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">supplier</span><span style="color:#000;font-weight:bold">();</span>
    BiConsumer<span style="color:#000;font-weight:bold">&lt;</span>A<span style="color:#000;font-weight:bold">,</span> T<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">accumulator</span><span style="color:#000;font-weight:bold">();</span>
    Function<span style="color:#000;font-weight:bold">&lt;</span>A<span style="color:#000;font-weight:bold">,</span> R<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">finisher</span><span style="color:#000;font-weight:bold">();</span>
    BinaryOperator<span style="color:#000;font-weight:bold">&lt;</span>A<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">combiner</span><span style="color:#000;font-weight:bold">();</span>
    Set<span style="color:#000;font-weight:bold">&lt;</span>Characteristics<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">characteristics</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>其中：</p>
<ul>
<li>T是要被收集的流中元素的类型</li>
<li>A是累加器的类型，在收集过程中，收集部分结果的对象。</li>
<li>R是结果类型</li>
</ul>
<p>比如你可以实现一个类<code>ToListCollector&lt;T&gt;</code> 将<code>Stream&lt;T&gt;</code>中所有的元素收集到<code>List&lt;T&gt;</code>中</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ToListCollector</span><span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#000;font-weight:bold">implements</span> Collector<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;,</span> List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;&gt;</span>
</code></pre></div><h3 id="理解collector接口声明的方法">理解Collector接口声明的方法</h3>
<h4 id="supplier方法">supplier方法</h4>
<p><code>supplier</code>方法必须返回一个空的累加器，比如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Supplier<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">supplier</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;();</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>也可以使用构造器引用：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Supplier<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">supplier</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000;font-weight:bold">return</span> ArrayList<span style="color:#000;font-weight:bold">::</span><span style="color:#000;font-weight:bold">new</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="accumulator方法">accumulator方法</h4>
<p><code>accumulator </code>方法返回一个执行归纳操作的函数。这个函数带2个参数，一个是累加器，一个是流中第n个元素，并返回void，因为累加器被就地修改。比如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> BiConsumer<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;,</span> T<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">accumulator</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span>list<span style="color:#000;font-weight:bold">,</span> item<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> list<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>item<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>也可以使用方法引用：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> BiConsumer<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;,</span> T<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">accumulator</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000;font-weight:bold">return</span> List<span style="color:#000;font-weight:bold">::</span>add<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="finisher方法">finisher方法</h4>
<p><code>finisher</code>方法返回一个在累加过程最后调用的函数，用于将累加器对象转换为最终结果，比如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Function<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;,</span> List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">finisher</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000;font-weight:bold">return</span> Function<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">identity</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>下图为<code>collect</code>方法处理过程</p>
<p><img src="/static/images/2019/07/23/collect.png" alt="collect.png"></p>
<h4 id="combiner方法">combiner方法</h4>
<p><code>combiner</code>方法返回一个方法用于并行处理时将流中不同的子部分元素合并起来，比如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> BinaryOperator<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">combiner</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span>list1<span style="color:#000;font-weight:bold">,</span> list2<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        list1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAll</span><span style="color:#000;font-weight:bold">(</span>list2<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">return</span> list1<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="characteristics方法">characteristics方法</h4>
<p><code>characteristics</code>方法返回<code>Characteristics</code>集合，定义了收集器的行为。特别是提示是否可以并行处理以及哪些优化可行。<code>Characteristics</code>是一个枚举：</p>
<ul>
<li>UNORDERED：归纳的结果不受遍历和累加流中元素的顺序的影响</li>
<li>CONCURRENT：累加方法可以被多个线程并发调用，收集器可以在流上执行并行归纳。</li>
<li>IDENTITY_FINISH：<code>finisher</code>方法返回的结果是累加器本身，这意味着累加器A到结果R的类型转换不需要检查。</li>
</ul>
<h4 id="collect方法重载版本">collect方法重载版本</h4>
<p>对于<code>IDENTITY_FINISH</code>类型的收集操作，可以不需要实现<code>Collector</code>接口就能自定义收集操作。<code>collect</code>方法有一个重载版本接受3个参数——<code>supplier</code>，<code>accumulator</code>，<code>combiner</code>：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#000;font-weight:bold">&lt;</span>Dish<span style="color:#000;font-weight:bold">&gt;</span> dishes <span style="color:#000;font-weight:bold">=</span> menuStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>ArrayList<span style="color:#000;font-weight:bold">::</span><span style="color:#000;font-weight:bold">new</span><span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">::</span>add<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">::</span>addAll<span style="color:#000;font-weight:bold">);</span>
</code></pre></div><h2 id="开发自己的收集器">开发自己的收集器</h2>
<h3 id="只除质数">只除质数</h3>
<p>判断一个数是否是质数，只需将这个数除以比它小的质数即可，不用每一个数都去测试</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">isPrime</span><span style="color:#000;font-weight:bold">(</span>List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> primes<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> candidate<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> primes<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">noneMatch</span><span style="color:#000;font-weight:bold">(</span>i <span style="color:#000;font-weight:bold">-&gt;</span> candidate <span style="color:#000;font-weight:bold">%</span> i <span style="color:#000;font-weight:bold">==</span> 0<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">isPrime</span><span style="color:#000;font-weight:bold">(</span>List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> primes<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">int</span> candidate<span style="color:#000;font-weight:bold">){</span>
    <span style="color:#458;font-weight:bold">int</span> candidateRoot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span> Math<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sqrt</span><span style="color:#000;font-weight:bold">((</span><span style="color:#458;font-weight:bold">double</span><span style="color:#000;font-weight:bold">)</span> candidate<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">return</span> primes<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stream</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">takeWhile</span><span style="color:#000;font-weight:bold">(</span>i <span style="color:#000;font-weight:bold">-&gt;</span> i <span style="color:#000;font-weight:bold">&lt;=</span> candidateRoot<span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">noneMatch</span><span style="color:#000;font-weight:bold">(</span>i <span style="color:#000;font-weight:bold">-&gt;</span> candidate <span style="color:#000;font-weight:bold">%</span> i <span style="color:#000;font-weight:bold">==</span> 0<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="定义收集器类">定义收集器类</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PrimeNumbersCollector</span> <span style="color:#000;font-weight:bold">implements</span> Collector<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">,</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;,</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span>
</code></pre></div><h4 id="实现归纳过程">实现归纳过程</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Supplier<span style="color:#000;font-weight:bold">&lt;</span>Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#900;font-weight:bold">supplier</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;()</span> <span style="color:#000;font-weight:bold">{{</span>
        put<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;());</span>
        put<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;());</span>
    <span style="color:#000;font-weight:bold">}};</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">public</span> BiConsumer<span style="color:#000;font-weight:bold">&lt;</span>Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">accumulator</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> acc<span style="color:#000;font-weight:bold">,</span> Integer candidate<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        acc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>isPrime<span style="color:#000;font-weight:bold">(</span>acc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">),</span> candidate<span style="color:#000;font-weight:bold">))</span>
            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>candidate<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">};</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="尽可能并行收集">尽可能并行收集</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> BinaryOperator<span style="color:#000;font-weight:bold">&lt;</span>Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#900;font-weight:bold">combiner</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> map1<span style="color:#000;font-weight:bold">,</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> map2<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        map1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">addAll</span><span style="color:#000;font-weight:bold">(</span>map2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">));</span>
        map1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">addAll</span><span style="color:#000;font-weight:bold">(</span>map2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">));</span>
        <span style="color:#000;font-weight:bold">return</span> map1<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">};</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="最后两个方法">最后两个方法</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Function<span style="color:#000;font-weight:bold">&lt;</span>Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;,</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#900;font-weight:bold">finisher</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> Function<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">identity</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">public</span> Set<span style="color:#000;font-weight:bold">&lt;</span>Characteristics<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">characteristics</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> Collections<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">unmodifiableSet</span><span style="color:#000;font-weight:bold">(</span>EnumSet<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span>IDENTITY_FINISH<span style="color:#000;font-weight:bold">));</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>现在可以使用这个自定义的收集器分区质数：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">partitionPrimesWithCustomCollector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> n<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">return</span> IntStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rangeClosed</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">,</span> n<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">boxed</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> PrimeNumbersCollector<span style="color:#000;font-weight:bold">());</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>也可以使用<code>collect</code>接受3个参数的重载版本，但是这样可读性变差了，而且代码也不能复用了。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">partitionPrimesWithCustomCollector</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> n<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    IntStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rangeClosed</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">,</span> n<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">boxed</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">collect</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;()</span> <span style="color:#000;font-weight:bold">{{</span>
            put<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;());</span>
            put<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;());</span>
        <span style="color:#000;font-weight:bold">}},</span>
        <span style="color:#000;font-weight:bold">(</span>acc<span style="color:#000;font-weight:bold">,</span> candidate<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
            acc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>isPrime<span style="color:#000;font-weight:bold">(</span>acc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">),</span> candidate<span style="color:#000;font-weight:bold">))</span>
                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>candidate<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000;font-weight:bold">(</span>map1<span style="color:#000;font-weight:bold">,</span> map2<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
            map1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">addAll</span><span style="color:#000;font-weight:bold">(</span>map2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">));</span>
            map1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">addAll</span><span style="color:#000;font-weight:bold">(</span>map2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">));</span>
        <span style="color:#000;font-weight:bold">});</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="http://gitop.cc">招财猫</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="http://gitop.cc/posts/collecting-data-with-streams/">http://gitop.cc/posts/collecting-data-with-streams/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/working-with-streams/">使用流</a></li>
        
        <li><a href="/posts/introducing-streams/">流介绍</a></li>
        
        <li><a href="/posts/lambda-expressions/">Lambda表达式</a></li>
        
        <li><a href="/posts/git-multi-sshkey/">Git配置多个SSH-Key</a></li>
        
        <li><a href="/posts/tpch-test/">Greenplum TPC-H测试</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='http://gitop.cc/tags/Java'>Java</a></li>
                
            </ul>
            
        </div>
    </article>
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "your github repo"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='http://gitop.cc/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://gitop.cc">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://gitop.cc/posts/scrapy-fundamental/" title="Scrapy爬虫基础">Scrapy爬虫基础</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/xpath/" title="XPath教程">XPath教程</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/refactoring-testing-debugging/" title="重构、测试和调试">重构、测试和调试</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/collection-api-enhancements/" title="Collection API增强">Collection API增强</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/parallel-data-processing-and-performance/" title="并行数据处理和性能">并行数据处理和性能</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/collecting-data-with-streams/" title="使用流收集数据">使用流收集数据</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/working-with-streams/" title="使用流">使用流</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/introducing-streams/" title="流介绍">流介绍</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/lambda-expressions/" title="Lambda表达式">Lambda表达式</a>
    </li>
    
    <li>
        <a href="http://gitop.cc/posts/git-multi-sshkey/" title="Git配置多个SSH-Key">Git配置多个SSH-Key</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li><a href="http://gitop.cc/categories/Crawler/">Crawler (1)</a></li>
    
    <li><a href="http://gitop.cc/categories/Database/">Database (12)</a></li>
    
    <li><a href="http://gitop.cc/categories/GUI/">GUI (5)</a></li>
    
    <li><a href="http://gitop.cc/categories/Gist/">Gist (1)</a></li>
    
    <li><a href="http://gitop.cc/categories/Language/">Language (23)</a></li>
    
    <li><a href="http://gitop.cc/categories/Linux/">Linux (3)</a></li>
    
    <li><a href="http://gitop.cc/categories/Network/">Network (4)</a></li>
    
    <li><a href="http://gitop.cc/categories/Tool/">Tool (4)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="http://gitop.cc/tags/C/">C</a>
    
    <a href="http://gitop.cc/tags/C&#43;&#43;/">C&#43;&#43;</a>
    
    <a href="http://gitop.cc/tags/CentOS/">CentOS</a>
    
    <a href="http://gitop.cc/tags/Docker/">Docker</a>
    
    <a href="http://gitop.cc/tags/Git/">Git</a>
    
    <a href="http://gitop.cc/tags/Greenplum/">Greenplum</a>
    
    <a href="http://gitop.cc/tags/Idea/">Idea</a>
    
    <a href="http://gitop.cc/tags/Java/">Java</a>
    
    <a href="http://gitop.cc/tags/Javascript/">Javascript</a>
    
    <a href="http://gitop.cc/tags/Markdown/">Markdown</a>
    
    <a href="http://gitop.cc/tags/MySQL/">MySQL</a>
    
    <a href="http://gitop.cc/tags/PostgreSQL/">PostgreSQL</a>
    
    <a href="http://gitop.cc/tags/ProjectEuler/">ProjectEuler</a>
    
    <a href="http://gitop.cc/tags/Python/">Python</a>
    
    <a href="http://gitop.cc/tags/Scrapy/">Scrapy</a>
    
    <a href="http://gitop.cc/tags/Ubuntu/">Ubuntu</a>
    
    <a href="http://gitop.cc/tags/XPath/">XPath</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="http://gitop.cc/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="http://gitop.cc">招财猫的博客 By 招财猫</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>