
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>PyQt编程第六章 主窗口 | opensvn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="opensvn">
    

    
    <meta name="description" content="创建一个主窗口import os
import platform
import sys
from PyQt4.QtCore import *
from PyQt4.QtGui import *
import helpform
import newimagedlg
import qrc_resources
__version__ = &quot;1.0.0&quot;
import的顺序：先Python标准模块，然后第">
<meta property="og:type" content="article">
<meta property="og:title" content="PyQt编程第六章 主窗口">
<meta property="og:url" content="https://opensvn.github.io/2015/10/21/pyqt-6/index.html">
<meta property="og:site_name" content="opensvn">
<meta property="og:description" content="创建一个主窗口import os
import platform
import sys
from PyQt4.QtCore import *
from PyQt4.QtGui import *
import helpform
import newimagedlg
import qrc_resources
__version__ = &quot;1.0.0&quot;
import的顺序：先Python标准模块，然后第">
<meta property="og:updated_time" content="2015-10-27T11:12:35.816Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PyQt编程第六章 主窗口">
<meta name="twitter:description" content="创建一个主窗口import os
import platform
import sys
from PyQt4.QtCore import *
from PyQt4.QtGui import *
import helpform
import newimagedlg
import qrc_resources
__version__ = &quot;1.0.0&quot;
import的顺序：先Python标准模块，然后第">

    
    <link rel="alternative" href="/atom.xml" title="opensvn" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/author.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/author.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/author.jpg" alt="opensvn" title="opensvn"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="opensvn">opensvn</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/archives">归档 | Archives</a></li>
					
						<li><a href="/about">关于 | About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:opensvn.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/21/pyqt-6/" title="PyQt编程第六章 主窗口" itemprop="url">PyQt编程第六章 主窗口</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="opensvn" target="_blank" itemprop="author">opensvn</a>
		
  <p class="article-time">
    <time datetime="2015-10-21T03:25:57.000Z" itemprop="datePublished"> 发表于 2015-10-21</time>
    
  </p>
</header>
	<div class="article-content">
		
		<h1 id="创建一个主窗口">创建一个主窗口</h1><pre><code><span class="preprocessor"><span class="keyword">import</span> os</span>
<span class="preprocessor"><span class="keyword">import</span> platform</span>
<span class="preprocessor"><span class="keyword">import</span> sys</span>
from PyQt4.QtCore <span class="preprocessor"><span class="keyword">import</span> *</span>
from PyQt4.QtGui <span class="preprocessor"><span class="keyword">import</span> *</span>
<span class="preprocessor"><span class="keyword">import</span> helpform</span>
<span class="preprocessor"><span class="keyword">import</span> newimagedlg</span>
<span class="preprocessor"><span class="keyword">import</span> qrc_resources</span>
__version__ = <span class="string">"1.0.0"</span>
</code></pre><p><code>import</code>的顺序：先Python标准模块，然后第三方模块(比如PyQt)，最后自己定义的模块。<br>一个程序通常有一个版本字符串，按照惯例称为<code>__version__</code>。</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span><span class="params">(QMainWindow)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent=None)</span>:</span>
        super(MainWindow, self).__init__(parent)
        self.image = QImage()
        self.dirty = <span class="keyword">False</span>
        self.filename = <span class="keyword">None</span>
        self.mirroredvertically = <span class="keyword">False</span>
        self.mirroredhorizontally = <span class="keyword">False</span>
</code></pre><p><code>QImage</code>并不是继承自<code>QObject</code>，不需要<code>parent</code>。</p>
<pre><code>self<span class="class">.imageLabel</span> = <span class="function"><span class="title">QLabel</span><span class="params">()</span></span>
self<span class="class">.imageLabel</span><span class="class">.setMinimumSize</span>(<span class="number">200</span>, <span class="number">200</span>)
self<span class="class">.imageLabel</span><span class="class">.setAlignment</span>(Qt.AlignCenter)
self<span class="class">.imageLabel</span><span class="class">.setContextMenuPolicy</span>(Qt.ActionsContextMenu)
self.<span class="function"><span class="title">setCentralWidget</span><span class="params">(self.imageLabel)</span></span>
</code></pre><p>PyQt提供许多种方式创建右键菜单，我们使用最简单和最常见的方式。首先必须设置部件的右键菜单策略，然后<br>给部件添加一些操作。</p>
<p>和对话框不一样，在一个主窗口风格的程序中，只有一个中心部件，尽管它可以是组合而成的。我么只需要调用<br><code>setCentralWidget</code>就好了。</p>
<p>在PyQt中，悬浮窗口是<code>QDockWidget</code>类的实例。我们可以添加一个部件到悬浮部件。</p>
<pre><code><span class="keyword">log</span>DockWidget = QDockWidget(<span class="string">"Log"</span>, <span class="literal">self</span>)
<span class="keyword">log</span>DockWidget.<span class="built_in">set</span>ObjectName(<span class="string">"LogDockWidget"</span>)
<span class="keyword">log</span>DockWidget.<span class="built_in">set</span>AllowedAreas(Qt.LeftDockWidgetArea|
                              Qt.RightDockWidgetArea)
<span class="literal">self</span>.listWidget = QListWidget()
<span class="keyword">log</span>DockWidget.<span class="built_in">set</span>Widget(<span class="literal">self</span>.listWidget)
<span class="literal">self</span>.addDockWidget(Qt.RightDockWidgetArea, <span class="keyword">log</span>DockWidget)
</code></pre><p>悬浮部件不会被加入布局，所以当创建它们时，需要指定<code>parent</code>。</p>
<p>每一个PyQt对象都可以指定一个对象名字。PyQt使用对象名字区分悬浮部件。<br><code>setFeatures</code>方法控制悬浮部件能否移动，悬浮或关闭。</p>
<p><code>QPrinter</code>对象管理打印机操作。</p>
<pre><code><span class="literal">self</span>.sizeLabel = QLabel()
<span class="literal">self</span>.sizeLabel.<span class="built_in">set</span>FrameStyle(QFrame.StyledPanel|QFrame.Sunken)
status = <span class="literal">self</span>.statusBar()
status.<span class="built_in">set</span>SizeGripEnabled(False)
status.addPermanentWidget(<span class="literal">self</span>.sizeLabel)
status.showMessage(<span class="string">"Ready"</span>, <span class="number">5000</span>)
</code></pre><p>状态栏由<code>QMainWindow</code>第一次调用<code>statusBar</code>创建。<code>showMessage</code>在状态栏显示信息直到另一个<br><code>showMessage</code>被调用或<code>clearMessage</code>被调用。</p>
<h1 id="动作和键序列">动作和键序列</h1><p>PyQt用<code>QAction</code>封装用户动作。</p>
<pre><code>fileNewAction = <span class="function"><span class="title">QAction</span><span class="params">(QIcon(<span class="string">"images/filenew.png"</span>)</span></span>, <span class="string">"&amp;New"</span>, self)
fileNewAction.<span class="function"><span class="title">setShortcut</span><span class="params">(QKeySequence.New)</span></span>
helpText = <span class="string">"Create a new image"</span>
fileNewAction.<span class="function"><span class="title">setToolTip</span><span class="params">(helpText)</span></span>
fileNewAction.<span class="function"><span class="title">setStatusTip</span><span class="params">(helpText)</span></span>
self.<span class="function"><span class="title">connect</span><span class="params">(fileNewAction, SIGNAL(<span class="string">"triggered()"</span>)</span></span>, self.fileNew)
</code></pre><p>许多键序列都标准化了，有些甚至跨平台。比如<code>Ctrl+N</code>对应新建，<code>Ctrl+S</code>对应保存。<br><code>QKeySequence</code>提供标准化的键序列常量，如<code>QKeySequence.New</code>，<code>QKeySequence.Paste</code><br>对于还未标准化的键序列(或向后兼容的原因)，可以用字符串作为快捷键，setShortcut(“Ctrl+Q”)。</p>
<p>注意我们给<code>QAction</code>一个self作为父亲。每一个<code>QObject</code>子类(除了顶级窗口)都有一个父亲。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>a.data()</td>
<td style="text-align:left">返回QAction a的数据，作为QVariant</td>
</tr>
<tr>
<td>a.setData(v)</td>
<td style="text-align:left">设置QAction a的数据为QVariant v</td>
</tr>
<tr>
<td>a.isChecked()</td>
<td style="text-align:left">返回True如果QAction a被确认过</td>
</tr>
<tr>
<td>a.setChecked(b)</td>
<td style="text-align:left">选与不选QAction a取决于bool b</td>
</tr>
<tr>
<td>a.isEnabled()</td>
<td style="text-align:left">返回True如果QAction a生效</td>
</tr>
<tr>
<td>a.setEnabled(b)</td>
<td style="text-align:left">生效或失效QAction a取决于bool b</td>
</tr>
<tr>
<td>a.setSeparator(b)</td>
<td style="text-align:left">设置QAction a为正常动作或分隔符取决于bool b</td>
</tr>
<tr>
<td>a.setShortcut(k)</td>
<td style="text-align:left">设置QAction a的快捷键为QKeySequence k</td>
</tr>
<tr>
<td>a.setStatusTip(s)</td>
<td style="text-align:left">设置QAction a的状态提示为string s</td>
</tr>
<tr>
<td>a.setText(s)</td>
<td style="text-align:left">设置QAction a的文本为string s</td>
</tr>
<tr>
<td>a.setToolTip(s)</td>
<td style="text-align:left">设置QAction a的工具提示为string s</td>
</tr>
<tr>
<td>a.setWhatsThis(s)</td>
<td style="text-align:left">设置QAction a的What’s This?文本为string s</td>
</tr>
<tr>
<td>a.toggled(b)</td>
<td style="text-align:left">这个信号被发射当QAction a的选中状态改变；bool b为True如果动作被选中</td>
</tr>
<tr>
<td>a.triggered(b)</td>
<td style="text-align:left">这个信号被发射QAction a被调用；bool b为True如果a被选中</td>
</tr>
</tbody>
</table>
<p>一旦创建了动作，我们就能把它添加到菜单或工具栏。</p>
<pre><code>fileMenu.<span class="function"><span class="title">addAction</span><span class="params">(fileNewAction)</span></span>
fileToolbar.<span class="function"><span class="title">addAction</span><span class="params">(fileNewAction)</span></span>
</code></pre><h1 id="资源文件">资源文件</h1><p>创建一个资源模块需要做两件事情。第一创建一个<code>.qrc</code>的文件，包含程序详细的资源。然后运行<code>pyrcc4</code><br>读取<code>.qrc</code>文件生成资源模块。<code>.qrc</code>是一个XML格式的文件。</p>
<pre><code><span class="doctype">&lt;!DOCTYPE RCC&gt;</span><span class="tag">&lt;<span class="title">RCC</span> <span class="attribute">version</span>=<span class="value">"1.0"</span>&gt;</span>
<span class="tag">&lt;<span class="title">qresource</span>&gt;</span>
<span class="tag">&lt;<span class="title">file</span> <span class="attribute">alias</span>=<span class="value">"filenew.png"</span>&gt;</span>images/filenew.png<span class="tag">&lt;/<span class="title">file</span>&gt;</span>
<span class="tag">&lt;<span class="title">file</span> <span class="attribute">alias</span>=<span class="value">"fileopen.png"</span>&gt;</span>images/fileopen.png<span class="tag">&lt;/<span class="title">file</span>&gt;</span>
···
<span class="tag">&lt;<span class="title">file</span> <span class="attribute">alias</span>=<span class="value">"icon.png"</span>&gt;</span>images/icon.png<span class="tag">&lt;/<span class="title">file</span>&gt;</span>
<span class="tag">&lt;<span class="title">file</span>&gt;</span>help/editmenu.html<span class="tag">&lt;/<span class="title">file</span>&gt;</span>
<span class="tag">&lt;<span class="title">file</span>&gt;</span>help/filemenu.html<span class="tag">&lt;/<span class="title">file</span>&gt;</span>
<span class="tag">&lt;<span class="title">file</span>&gt;</span>help/index.html<span class="tag">&lt;/<span class="title">file</span>&gt;</span>
<span class="tag">&lt;/<span class="title">qresource</span>&gt;</span>
<span class="tag">&lt;/<span class="title">RCC</span>&gt;</span>
</code></pre><p>现在使用一个新建文件的图片，我们可以写成<code>QIcon(&quot;:/images/filenew.png&quot;)</code>，多亏了别名，<br>也可以缩写为<code>QIcon(&quot;:/filenew.png&quot;)</code>。前面的:/告诉PyQt文件是一个资源。在使用资源之前，<br>必须生成资源模块并导入进程序。</p>
<pre><code>C:\pyqt\chap06&gt;pyrcc4 -o qrc_resources<span class="class">.py</span> resources.qrc
</code></pre><h1 id="创建和使用动作">创建和使用动作</h1><p>一个辅助创建动作的函数：</p>
<pre><code>def createAction(self, text, slot=None, shortcut=None, <span class="attribute">icon</span>=None,
                 tip=None, checkable=False, signal=<span class="string">"triggered()"</span>):
    action = <span class="function"><span class="title">QAction</span><span class="params">(text, self)</span></span>
    <span class="keyword">if</span> <span class="attribute">icon</span> is not None:
        action.<span class="function"><span class="title">setIcon</span><span class="params">(QIcon(<span class="string">":/%s.png"</span> % icon)</span></span>)
    <span class="keyword">if</span> shortcut is not None:
        action.<span class="function"><span class="title">setShortcut</span><span class="params">(shortcut)</span></span>
    <span class="keyword">if</span> tip is not None:
        action.<span class="function"><span class="title">setToolTip</span><span class="params">(tip)</span></span>
        action.<span class="function"><span class="title">setStatusTip</span><span class="params">(tip)</span></span>
    <span class="keyword">if</span> slot is not None:
        self.<span class="function"><span class="title">connect</span><span class="params">(action, SIGNAL(signal)</span></span>, slot)
    <span class="keyword">if</span> checkable:
        action.<span class="function"><span class="title">setCheckable</span><span class="params">(True)</span></span>
    return action
fileNewAction = self.createAction(<span class="string">"&amp;New..."</span>, self<span class="class">.fileNew</span>,
        QKeySequence<span class="class">.New</span>, <span class="string">"filenew"</span>, <span class="string">"Create an image file"</span>)
fileQuitAction = self.createAction(<span class="string">"&amp;Quit"</span>, self<span class="class">.close</span>,
        <span class="string">"Ctrl+Q"</span>, <span class="string">"filequit"</span>, <span class="string">"Close the application"</span>)
editZoomAction = self.createAction(<span class="string">"&amp;Zoom..."</span>, self<span class="class">.editZoom</span>,
        <span class="string">"Alt+Z"</span>, <span class="string">"editzoom"</span>, <span class="string">"Zoom the image"</span>)
editInvertAction = self.createAction(<span class="string">"&amp;Invert"</span>,
        self<span class="class">.editInvert</span>, <span class="string">"Ctrl+I"</span>, <span class="string">"editinvert"</span>,
        <span class="string">"Invert the image's colors"</span>, True, <span class="string">"toggled(bool)"</span>)
</code></pre><p><code>toggled(bool)</code>信号不仅告诉我们动作被调用，而且返回动作是否被选中。</p>
<p>一个动作组管理一组动作使得任何时候只有一个动作被选中。</p>
<pre><code>mirrorGroup = <span class="function"><span class="title">QActionGroup</span><span class="params">(self)</span></span>
editUnMirrorAction = self.createAction(<span class="string">"&amp;Unmirror"</span>,
        self<span class="class">.editUnMirror</span>, <span class="string">"Ctrl+U"</span>, <span class="string">"editunmirror"</span>,
        <span class="string">"Unmirror the image"</span>, True, <span class="string">"toggled(bool)"</span>)
mirrorGroup.<span class="function"><span class="title">addAction</span><span class="params">(editUnMirrorAction)</span></span>
editUnMirrorAction.<span class="function"><span class="title">setChecked</span><span class="params">(True)</span></span>
</code></pre><p>可选中的动作默认是未选中状态，所以在动作组中初始时必须选择一个为选中状态。</p>
<p>虽然所有动作已经创建好，但是它们还不能工作。只有当动作加进菜单或工具栏才能起作用。</p>
<pre><code>editMenu = self.<span class="function"><span class="title">menuBar</span><span class="params">()</span></span>.<span class="function"><span class="title">addMenu</span><span class="params">(<span class="string">"&amp;Edit"</span>)</span></span>
self.addActions(editMenu, (editInvertAction,
        editSwapRedAndBlueAction, editZoomAction))
def <span class="function"><span class="title">addActions</span><span class="params">(self, target, actions)</span></span>:
    <span class="keyword">for</span> action <span class="keyword">in</span> actions:
        <span class="keyword">if</span> action is None:
            target.<span class="function"><span class="title">addSeparator</span><span class="params">()</span></span>
        <span class="keyword">else</span>:
            target.<span class="function"><span class="title">addAction</span><span class="params">(action)</span></span>
</code></pre><p>也可以使用<code>QWidget.addActions</code>添加多个动作到菜单或工具栏。</p>
<pre><code>mirrorMenu = editMenu.<span class="function"><span class="title">addMenu</span><span class="params">(QIcon(<span class="string">":/editmirror.png"</span>)</span></span>,
                              <span class="string">"&amp;Mirror"</span>)
self.addActions(mirrorMenu, (editUnMirrorAction,
        editMirrorHorizontalAction, editMirrorVerticalAction))
</code></pre><p>子目录的创建和其它目录一样，不同的是使用<code>QMenu.addMenu</code>加进父目录。</p>
<pre><code>self<span class="class">.fileMenu</span> = self.<span class="function"><span class="title">menuBar</span><span class="params">()</span></span>.<span class="function"><span class="title">addMenu</span><span class="params">(<span class="string">"&amp;File"</span>)</span></span>
self<span class="class">.fileMenuActions</span> = (fileNewAction, fileOpenAction,
        fileSaveAction, fileSaveAsAction, None,
        filePrintAction, fileQuitAction)
self.<span class="function"><span class="title">connect</span><span class="params">(self.fileMenu, SIGNAL(<span class="string">"aboutToShow()"</span>)</span></span>,
             self.updateFileMenu)

fileToolbar = self.<span class="function"><span class="title">addToolBar</span><span class="params">(<span class="string">"File"</span>)</span></span>
fileToolbar.<span class="function"><span class="title">setObjectName</span><span class="params">(<span class="string">"FileToolBar"</span>)</span></span>
self.addActions(fileToolbar, (fileNewAction, fileOpenAction,
                              fileSaveAsAction))
</code></pre><p><code>addToolBar</code>创建一个<code>QToolBar</code>对象。</p>
<pre><code>editToolbar = self.<span class="function"><span class="title">addToolBar</span><span class="params">(<span class="string">"Edit"</span>)</span></span>
editToolbar.<span class="function"><span class="title">setObjectName</span><span class="params">(<span class="string">"EditToolBar"</span>)</span></span>
self.addActions(editToolbar, (editInvertAction,
        editSwapRedAndBlueAction, editUnMirrorAction,
        editMirrorVerticalAction,
        editMirrorHorizontalAction))
</code></pre><p>添加部件到工具栏都一样： 创建部件，配置好部件，连接信号，然后把部件添加到工具栏</p>
<pre><code>self<span class="class">.zoomSpinBox</span> = <span class="function"><span class="title">QSpinBox</span><span class="params">()</span></span>
self<span class="class">.zoomSpinBox</span><span class="class">.setRange</span>(<span class="number">1</span>, <span class="number">400</span>)
self<span class="class">.zoomSpinBox</span><span class="class">.setSuffix</span>(<span class="string">" %"</span>)
self<span class="class">.zoomSpinBox</span><span class="class">.setValue</span>(<span class="number">100</span>)
self<span class="class">.zoomSpinBox</span><span class="class">.setToolTip</span>(<span class="string">"Zoom the image"</span>)
self<span class="class">.zoomSpinBox</span><span class="class">.setStatusTip</span>(self<span class="class">.zoomSpinBox</span><span class="class">.toolTip</span>())
self<span class="class">.zoomSpinBox</span><span class="class">.setFocusPolicy</span>(Qt.NoFocus)
self.connect(self<span class="class">.zoomSpinBox</span>,
             <span class="function"><span class="title">SIGNAL</span><span class="params">(<span class="string">"valueChanged(int)"</span>)</span></span>, self.showImage)
editToolbar.<span class="function"><span class="title">addWidget</span><span class="params">(self.zoomSpinBox)</span></span>
</code></pre><p>之前有一行这样的代码：</p>
<pre><code><span class="tag">self</span><span class="class">.imageLabel</span><span class="class">.setContextMenuPolicy</span>(<span class="tag">Qt</span><span class="class">.ActionsContextMenu</span>)
</code></pre><p>它告诉PyQt，如果动作被加进imageLabel部件，它们也被用作右键菜单。</p>
<pre><code><span class="keyword">self</span>.addActions(<span class="keyword">self</span>.imageLabel, (editInvertAction,
        editSwapRedAndBlueAction, editUnMirrorAction,
        editMirrorVerticalAction, editMirrorHorizontalAction))
</code></pre><p><code>QWidget</code>类有一个<code>addAction</code>方法，因此<code>QMenu</code>，<code>QMenuBar</code>，<code>QToolBar</code>都继承了这个方法。<br>尽管<code>QWidget</code>没有<code>addSeparator</code>方法，为了方便，<code>QMenu</code>，<code>QMenuBar</code>，<code>QToolBar</code>都提供了。<br>如果要添加一个分隔符到右键菜单，则必须添加一个分隔动作。</p>
<pre><code>separator = <span class="function"><span class="title">QAction</span><span class="params">(self)</span></span>
separator.<span class="function"><span class="title">setSeparator</span><span class="params">(True)</span></span>
self.addActions(editToolbar, (editInvertAction,
        editSwapRedAndBlueAction, separator, editUnMirrorAction,
        editMirrorVerticalAction, editMirrorHorizontalAction))
</code></pre><h1 id="恢复和保存主窗口状态">恢复和保存主窗口状态</h1><pre><code>def <span class="function"><span class="title">main</span><span class="params">()</span></span>:
    app = <span class="function"><span class="title">QApplication</span><span class="params">(sys.argv)</span></span>
    app.<span class="function"><span class="title">setOrganizationName</span><span class="params">(<span class="string">"Qtrac Ltd."</span>)</span></span>
    app.<span class="function"><span class="title">setOrganizationDomain</span><span class="params">(<span class="string">"qtrac.eu"</span>)</span></span>
    app.<span class="function"><span class="title">setApplicationName</span><span class="params">(<span class="string">"Image Changer"</span>)</span></span>
    app.<span class="function"><span class="title">setWindowIcon</span><span class="params">(QIcon(<span class="string">":/icon.png"</span>)</span></span>)
    <span class="tag">form</span> = <span class="function"><span class="title">MainWindow</span><span class="params">()</span></span>
    <span class="tag">form</span>.<span class="function"><span class="title">show</span><span class="params">()</span></span>
    app.<span class="function"><span class="title">exec_</span><span class="params">()</span></span>
</code></pre><p>函数main的第二行到第四行的主要作用就是程序配置的加载和保存。如果不传任何参数给<code>QSettings</code>对象，<br>则它会使用这三行代码设定的名字。这些名字使得程序配置保存在合适的地方，比如Windows的注册表，Linux<br>的$HOME/.config</p>
<pre><code>settings = <span class="function"><span class="title">QSettings</span><span class="params">()</span></span>
self<span class="class">.recentFiles</span> = settings.<span class="function"><span class="title">value</span><span class="params">(<span class="string">"RecentFiles"</span>)</span></span>.<span class="function"><span class="title">toStringList</span><span class="params">()</span></span>
size = settings.value(<span class="string">"MainWindow/Size"</span>,
                      <span class="function"><span class="title">QVariant</span><span class="params">(QSize(<span class="number">600</span>, <span class="number">500</span>)</span></span>)).<span class="function"><span class="title">toSize</span><span class="params">()</span></span>
self.<span class="function"><span class="title">resize</span><span class="params">(size)</span></span>
<span class="attribute">position</span> = settings.value(<span class="string">"MainWindow/Position"</span>,
                          <span class="function"><span class="title">QVariant</span><span class="params">(QPoint(<span class="number">0</span>, <span class="number">0</span>)</span></span>)).<span class="function"><span class="title">toPoint</span><span class="params">()</span></span>
self.<span class="function"><span class="title">move</span><span class="params">(position)</span></span>
self.restoreState(
        settings.<span class="function"><span class="title">value</span><span class="params">(<span class="string">"MainWindow/State"</span>)</span></span>.<span class="function"><span class="title">toByteArray</span><span class="params">()</span></span>)
self.<span class="function"><span class="title">setWindowTitle</span><span class="params">(<span class="string">"Image Changer"</span>)</span></span>
self.<span class="function"><span class="title">updateFileMenu</span><span class="params">()</span></span>
QTimer.<span class="function"><span class="title">singleShot</span><span class="params">(<span class="number">0</span>, self.loadInitialFile)</span></span>
</code></pre><p><code>QSettings.value()</code>返回一个<code>QVariant</code>，因此必须转换为我们期望的数据类型。<br>带2个参数形式的<code>value()</code>方法，第二个参数是默认值。</p>
<p><code>resize()</code>和<code>move()</code>并不会造成窗口抖动，因为这些操作是在窗口显示之前已经完成。<br>Qt4.2引入2个新的方法保存和恢复一个顶层窗口的几何位置。</p>
<pre><code>self.<span class="function"><span class="title">restoreGeometry</span><span class="params">(settings.value(<span class="string">"Geometry"</span>)</span></span>.<span class="function"><span class="title">toByteArray</span><span class="params">()</span></span>)
</code></pre><p><code>QMainWindow</code>类提供<code>restoreState()</code>和<code>saveState()</code>方法，来恢复自或保存到一个<code>QByteArray</code>。<br>它们只保存拥有唯一对象名的悬浮窗口的大小和位置以及工具栏的位置。</p>
<blockquote>
<p><strong>启动时做大量处理</strong><br>如果我们需要在启动时做大量处理，比如加载许多大文件，我们经常用一个独立的加载方法来做此事。<br>想象一下，比如这个方法是loadInitialFiles()，加载许多大文件。则在show()和事件循环(exec_())<br>开始之前，用户将体验到一个非常长的启动延迟。<br>我们希望窗口尽可能快的出现，使用户知道启动成功，并能够看到长时间运行的进程。这些通过0延迟的<br>singleShot计时器完成。因为它并不会立即执行连接的槽，相反它简单地将槽放到事件队列就返回。<br>0延迟计时器意思是，“当事件队列没有其它事件处理时处理这个事件”</p>
</blockquote>
<pre><code>def <span class="function"><span class="title">loadInitialFile</span><span class="params">(self)</span></span>:
    settings = <span class="function"><span class="title">QSettings</span><span class="params">()</span></span>
    fname = <span class="function"><span class="title">unicode</span><span class="params">(settings.value(<span class="string">"LastFile"</span>)</span></span>.<span class="function"><span class="title">toString</span><span class="params">()</span></span>)
    <span class="keyword">if</span> fname and QFile.<span class="function"><span class="title">exists</span><span class="params">(fname)</span></span>:
        self.<span class="function"><span class="title">loadFile</span><span class="params">(fname)</span></span>
</code></pre><p>如果用户试图关闭程序，不管什么方式，<code>closeEvent()</code>被调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">closeEvent</span><span class="params">(self, event)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.okToContinue():</span><br><span class="line">        settings = QSettings()</span><br><span class="line">        filename = QVariant(QString(self.filename)) \</span><br><span class="line">                <span class="keyword">if</span> self.filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> QVariant()</span><br><span class="line">        settings.setValue(<span class="string">"LastFile"</span>, filename)</span><br><span class="line">        recentFiles = QVariant(self.recentFiles) \</span><br><span class="line">                <span class="keyword">if</span> self.recentFiles <span class="keyword">else</span> QVariant()</span><br><span class="line">        settings.setValue(<span class="string">"RecentFiles"</span>, recentFiles)</span><br><span class="line">        settings.setValue(<span class="string">"MainWindow/Size"</span>, QVariant(self.size()))</span><br><span class="line">        settings.setValue(<span class="string">"MainWindow/Position"</span>,</span><br><span class="line">                QVariant(self.pos()))</span><br><span class="line">        settings.setValue(<span class="string">"MainWindow/State"</span>,</span><br><span class="line">                QVariant(self.saveState()))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        event.ignore()</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>语法</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>m.addDockWidget(a, d)</td>
<td style="text-align:left">在QMainWindow m中添加QDockWidget d到Qt.QDockWidgetArea a</td>
</tr>
<tr>
<td>m.addToolBar(s)</td>
<td style="text-align:left">添加并返回一个名叫string s的QToolBar</td>
</tr>
<tr>
<td>m.menuBar()</td>
<td style="text-align:left">返回QMainWindow m的QMenuBar(第一次调用创建目录)</td>
</tr>
<tr>
<td>m.restoreGeometry(ba)</td>
<td style="text-align:left">根据QByteArray ba恢复QMainWindow m的位置和大小(Qt4.3)</td>
</tr>
<tr>
<td>m.restoreState(ba)</td>
<td style="text-align:left">根据QByteArray ba恢复QMainWindow m的悬浮窗和工具栏的状态</td>
</tr>
<tr>
<td>m.saveGeometry()</td>
<td style="text-align:left">返回封装在QByteArray中QMainWindow m的位置和大小(Qt4.3)</td>
</tr>
<tr>
<td>m.saveState()</td>
<td style="text-align:left">返回封装在QByteArray中QMainWindow m的悬浮窗和工具栏的状态</td>
</tr>
<tr>
<td>m.setCentralWidget(w)</td>
<td style="text-align:left">设置QMainWindow m的中央部件为QWidget w</td>
</tr>
<tr>
<td>m.statusBar()</td>
<td style="text-align:left">返回QMainWindow的QStatusBar(第一次调用创建状态栏)</td>
</tr>
<tr>
<td>m.setWindowIcon(i)</td>
<td style="text-align:left">设置QMainWindow m的图标为QIcon i；这个方法继承自QWidget</td>
</tr>
<tr>
<td>m.setWindowTitle(s)</td>
<td style="text-align:left">设置QMainWindow m的标题为string s；这个方法继承自QWidget</td>
</tr>
</tbody>
</table>
<p>如果我们使用Qt4，使用<code>QWidget.restoreGeometry()</code>恢复窗口的几何位置，那么我们可以如此保存几何状态：</p>
<pre><code>settings.<span class="function"><span class="title">setValue</span><span class="params">(<span class="string">"Geometry"</span>, QVariant(self.saveGeometry()</span></span>))
</code></pre><p>使用这种方法，不需要单独保存主窗口的大小和位置。</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">okToContinue</span><span class="params">(self)</span>:</span>
    <span class="keyword">if</span> self.dirty:
    reply = QMessageBox.question(self,
                    <span class="string">"Image Changer - Unsaved Changes"</span>,
                    <span class="string">"Save unsaved changes?"</span>,
                    QMessageBox.Yes|QMessageBox.No|
                    QMessageBox.Cancel)
    <span class="keyword">if</span> reply == QMessageBox.Cancel:
        <span class="keyword">return</span> <span class="keyword">False</span>
    <span class="keyword">elif</span> reply == QMessageBox.Yes:
        self.fileSave()
    <span class="keyword">return</span> <span class="keyword">True</span>
</code></pre><p>有些开发者使用<code>QMessageBox.Save</code>和<code>QMessageBox.Discard</code>。</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">updateFileMenu</span><span class="params">(<span class="keyword">self</span>)</span>:</span>
    <span class="keyword">self</span>.fileMenu.clear()
    <span class="keyword">self</span>.addActions(<span class="keyword">self</span>.fileMenu, <span class="keyword">self</span>.fileMenuActions[<span class="symbol">:-</span><span class="number">1</span>])
    current = <span class="constant">QString</span>(<span class="keyword">self</span>.filename) \
            <span class="keyword">if</span> <span class="keyword">self</span>.filename is <span class="keyword">not</span> <span class="constant">None</span> <span class="keyword">else</span> <span class="constant">None</span>
    recentFiles = []
    <span class="keyword">for</span> fname <span class="keyword">in</span> <span class="keyword">self</span>.<span class="symbol">recentFiles:</span>
        <span class="keyword">if</span> fname != current <span class="keyword">and</span> <span class="constant">QFile</span>.exists(fname)<span class="symbol">:</span>
            recentFiles.append(fname)
    <span class="keyword">if</span> <span class="symbol">recentFiles:</span>
        <span class="keyword">self</span>.fileMenu.addSeparator()
        <span class="keyword">for</span> i, fname <span class="keyword">in</span> enumerate(recentFiles)<span class="symbol">:</span>
            action = <span class="constant">QAction</span>(<span class="constant">QIcon</span>(<span class="string">":/icon.png"</span>), <span class="string">"&amp;%d %s"</span> % (
                    i + <span class="number">1</span>, <span class="constant">QFileInfo</span>(fname).fileName()), <span class="keyword">self</span>)
            action.setData(<span class="constant">QVariant</span>(fname))
            <span class="keyword">self</span>.connect(action, <span class="constant">SIGNAL</span>(<span class="string">"triggered()"</span>),
                         <span class="keyword">self</span>.loadFile)
            <span class="keyword">self</span>.fileMenu.addAction(action)
    <span class="keyword">self</span>.fileMenu.addSeparator()
    <span class="keyword">self</span>.fileMenu.addAction(<span class="keyword">self</span>.fileMenuActions[-<span class="number">1</span>])
</code></pre><blockquote>
<p><strong>QMessageBox的静态方法</strong><br>QMessageBox类提供多个方便的静态方法，这些方法弹出一个有合适图标和按钮的模式对话框。<br>最常用的方法为critical()，information()，question()和waring()。这些方法携带参数<br>父类部件，窗口标题，消息文本(可以是纯文本或HTML)，0个或多个按钮。如果未指定按钮，则为OK按钮。<br>Qt4.0和Qt4.1中，OK按钮或Yes按钮位或QMessageBox.Default，Cancel按钮或No按钮位或<br>  QMessageBox.Escape很常见。<br>    reply = QMessageBox.question(self,<br>            “Image Changer - Unsaved Changes”, “Save unsaved changes?”,<br>            QMessageBox.Yes|QMessageBox.Default,<br>            QMessageBox.No|QMessageBox.Escape)<br>4.2中则自动绑定默认动作到相应的按钮上。<br>如果我们想创建自定义的消息框，可以创建一个QMessageBox实例，然后使用QMessageBox.addButton()<br>QMessageBox.setIcon()添加按钮，再调用QMessageBox.exec_()弹出消息框。</p>
</blockquote>
<pre><code>def <span class="function"><span class="title">addRecentFile</span><span class="params">(self, fname)</span></span>:
    <span class="keyword">if</span> fname is None:
        return
    <span class="keyword">if</span> not self<span class="class">.recentFiles</span><span class="class">.contains</span>(fname):
        self<span class="class">.recentFiles</span><span class="class">.prepend</span>(<span class="function"><span class="title">QString</span><span class="params">(fname)</span></span>)
        while self<span class="class">.recentFiles</span><span class="class">.count</span>() &gt; <span class="number">9</span>:
            self<span class="class">.recentFiles</span><span class="class">.takeLast</span>()
</code></pre><h1 id="处理文件动作">处理文件动作</h1><pre><code><span class="function"><span class="keyword">def</span> <span class="title">fileNew</span><span class="params">(self)</span>:</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.okToContinue():
        <span class="keyword">return</span>
    dialog = newimagedlg.NewImageDlg(self)
    <span class="keyword">if</span> dialog.exec_():
        self.addRecentFile(self.filename)
        self.image = QImage()
        <span class="keyword">for</span> action, check <span class="keyword">in</span> self.resetableActions:
            action.setChecked(check)
        self.image = dialog.image()
        self.filename = <span class="keyword">None</span>
        self.dirty = <span class="keyword">True</span>
        self.showImage()
        self.sizeLabel.setText(<span class="string">"%d x %d"</span> % (self.image.width(),
                                            self.image.height()))
        self.updateStatus(<span class="string">"Created new image"</span>)

<span class="function"><span class="keyword">def</span> <span class="title">updateStatus</span><span class="params">(self, message)</span>:</span>
    self.statusBar().showMessage(message, <span class="number">5000</span>)
    self.listWidget.addItem(message)
    <span class="keyword">if</span> self.filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:
        self.setWindowTitle(<span class="string">"Image Changer - %s[*]"</span> % \
                            os.path.basename(self.filename))
    <span class="keyword">elif</span> <span class="keyword">not</span> self.image.isNull():
        self.setWindowTitle(<span class="string">"Image Changer - Unnamed[*]"</span>)
    <span class="keyword">else</span>:
        self.setWindowTitle(<span class="string">"Image Changer[*]"</span>)
    self.setWindowModified(self.dirty)

<span class="function"><span class="keyword">def</span> <span class="title">fileOpen</span><span class="params">(self)</span>:</span>
    <span class="keyword">if</span> <span class="keyword">not</span> self.okToContinue():
        <span class="keyword">return</span>
    dir = os.path.dirname(self.filename) \
            <span class="keyword">if</span> self.filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">"."</span>
    formats = [<span class="string">"*.%s"</span> % unicode(format).lower() \
               <span class="keyword">for</span> format <span class="keyword">in</span> QImageReader.supportedImageFormats()]
    fname = unicode(QFileDialog.getOpenFileName(self,
                        <span class="string">"Image Changer - Choose Image"</span>, dir,
                        <span class="string">"Image files (%s)"</span> % <span class="string">" "</span>.join(formats)))
    <span class="keyword">if</span> fname:
        self.loadFile(fname)
</code></pre><p><code>QFileDialog.getOpenFileName()</code>返回一个<code>QString</code>保存文件名的绝对路径，或者返回空。</p>
<pre><code>fname = unicode(QFileDialog.getOpenFileName(self,
                <span class="string">"%s - Choose Image"</span> % QApplication.applicationName(),
                dir, <span class="string">"Image files (%s)"</span> % <span class="string">" "</span>.join(formats)))

<span class="function"><span class="keyword">def</span> <span class="title">loadFile</span><span class="params">(self, fname=None)</span>:</span>
    <span class="keyword">if</span> fname <span class="keyword">is</span> <span class="keyword">None</span>:
        action = self.sender()
        <span class="keyword">if</span> isinstance(action, QAction):
            fname = unicode(action.data().toString())
            <span class="keyword">if</span> <span class="keyword">not</span> self.okToContinue():
                <span class="keyword">return</span>
        <span class="keyword">else</span>:
            <span class="keyword">return</span>
    <span class="keyword">if</span> fname:
        self.filename = <span class="keyword">None</span>
        image = QImage(fname)
        <span class="keyword">if</span> image.isNull():
            message = <span class="string">"Failed to read %s"</span> % fname
        <span class="keyword">else</span>:
            self.addRecentFile(fname)
            self.image = QImage()
            <span class="keyword">for</span> action, check <span class="keyword">in</span> self.resetableActions:
                action.setChecked(check)
            self.image = image
            self.filename = fname
            self.showImage()
            self.dirty = <span class="keyword">False</span>
            self.sizeLabel.setText(<span class="string">"%d x %d"</span> % (
                        image.width(), image.height()))
            message = <span class="string">"Loaded %s"</span> % os.path.basename(fname)
        self.updateStatus(message)

<span class="function"><span class="keyword">def</span> <span class="title">fileSave</span><span class="params">(self)</span>:</span>
    <span class="keyword">if</span> self.image.isNull():
        <span class="keyword">return</span>
    <span class="keyword">if</span> self.filename <span class="keyword">is</span> <span class="keyword">None</span>:
        self.fileSaveAs()
    <span class="keyword">else</span>:
        <span class="keyword">if</span> self.image.save(self.filename, <span class="keyword">None</span>):
            self.updateStatus(<span class="string">"Saved as %s"</span> % self.filename)
            self.dirty = <span class="keyword">False</span>
        <span class="keyword">else</span>:
            self.updateStatus(<span class="string">"Failed to save %s"</span> % self.filename)

<span class="function"><span class="keyword">def</span> <span class="title">fileSaveAs</span><span class="params">(self)</span>:</span>
    <span class="keyword">if</span> self.image.isNull():
        <span class="keyword">return</span>
    fname = self.filename <span class="keyword">if</span> self.filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="string">"."</span>
    formats = [<span class="string">"*.%s"</span> % unicode(format).lower() \
               <span class="keyword">for</span> format <span class="keyword">in</span> QImageWriter.supportedImageFormats()]
    fname = unicode(QFileDialog.getSaveFileName(self,
                    <span class="string">"Image Changer - Save Image"</span>, fname,
                    <span class="string">"Image files (%s)"</span> % <span class="string">" "</span>.join(formats)))
    <span class="keyword">if</span> fname:
        <span class="keyword">if</span> <span class="string">"."</span> <span class="keyword">not</span> <span class="keyword">in</span> fname:
            fname += <span class="string">".png"</span>
        self.addRecentFile(fname)
        self.filename = fname
        self.fileSave()
</code></pre><p>QFileDialog.getSaveFileName()提示用户提供一个文件名用来保存当前文件。</p>
<h1 id="处理编辑动作">处理编辑动作</h1><pre><code>def <span class="function"><span class="title">editInvert</span><span class="params">(self, on)</span></span>:
    <span class="keyword">if</span> self<span class="class">.image</span><span class="class">.isNull</span>():
        return
    self<span class="class">.image</span><span class="class">.invertPixels</span>()
    self.<span class="function"><span class="title">showImage</span><span class="params">()</span></span>
    self<span class="class">.dirty</span> = True
    self.<span class="function"><span class="title">updateStatus</span><span class="params">(<span class="string">"Inverted"</span> if on else <span class="string">"Uninverted"</span>)</span></span>

def <span class="function"><span class="title">editMirrorHorizontal</span><span class="params">(self, on)</span></span>:
    <span class="keyword">if</span> self<span class="class">.image</span><span class="class">.isNull</span>():
        return
    self<span class="class">.image</span> = self<span class="class">.image</span><span class="class">.mirrored</span>(True, False)
    self.<span class="function"><span class="title">showImage</span><span class="params">()</span></span>
    self<span class="class">.mirroredhorizontally</span> = not self<span class="class">.mirroredhorizontally</span>
    self<span class="class">.dirty</span> = True
    self.updateStatus(<span class="string">"Mirrored Horizontally"</span> \
            <span class="keyword">if</span> on <span class="keyword">else</span> <span class="string">"Unmirrored Horizontally"</span>)

def <span class="function"><span class="title">editUnMirror</span><span class="params">(self, on)</span></span>:
    <span class="keyword">if</span> self<span class="class">.image</span><span class="class">.isNull</span>():
        return
    <span class="keyword">if</span> self<span class="class">.mirroredhorizontally</span>:
        self.<span class="function"><span class="title">editMirrorHorizontal</span><span class="params">(False)</span></span>
    <span class="keyword">if</span> self<span class="class">.mirroredvertically</span>:
        self.<span class="function"><span class="title">editMirrorVertical</span><span class="params">(False)</span></span>

def <span class="function"><span class="title">editZoom</span><span class="params">(self)</span></span>:
    <span class="keyword">if</span> self<span class="class">.image</span><span class="class">.isNull</span>():
        return
    percent, ok = QInputDialog.getInteger(self,
            <span class="string">"Image Changer - Zoom"</span>, <span class="string">"Percent:"</span>,
            self<span class="class">.zoomSpinBox</span><span class="class">.value</span>(), <span class="number">1</span>, <span class="number">400</span>)
    <span class="keyword">if</span> ok:
        self<span class="class">.zoomSpinBox</span><span class="class">.setValue</span>(percent)
</code></pre><p><code>QInputDialog</code>提供了一些其它方便的静态方法，<code>getDouble()</code>，<code>getItem()</code>，<code>getText()</code>。<br>所有这些方法返回一个tuple，包含一个指示用户是否输入的bool值和一个合法值。</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">showImage</span><span class="params">(self, percent=None)</span>:</span>
    <span class="keyword">if</span> self.image.isNull():
        <span class="keyword">return</span>
    <span class="keyword">if</span> percent <span class="keyword">is</span> <span class="keyword">None</span>:
        percent = self.zoomSpinBox.value()
    factor = percent / <span class="number">100.0</span>
    width = self.image.width() * factor
    height = self.image.height() * factor
    image = self.image.scaled(width, height, Qt.KeepAspectRatio)
    self.imageLabel.setPixmap(QPixmap.fromImage(image))
</code></pre><p>根据PyQt的文档，<code>QPixmap</code>对屏幕显示做了优化，而<code>QImage</code>对编辑做了优化，因此我们用它保存图像数据。</p>
<h1 id="处理帮助动作">处理帮助动作</h1><pre><code><span class="function"><span class="keyword">def</span> <span class="title">helpAbout</span><span class="params">(self)</span>:</span>
    QMessageBox.about(self, <span class="string">"About Image Changer"</span>,
            <span class="string">"""&lt;b&gt;Image Changer&lt;/b&gt; v %s
            &lt;p&gt;Copyright &amp;copy; 2007 Qtrac Ltd. 
            All rights reserved.
            &lt;p&gt;This application can be used to perform
            simple image manipulations.
            &lt;p&gt;Python %s - Qt %s - PyQt %s on %s"""</span> % (
            __version__, platform.python_version(),
            QT_VERSION_STR, PYQT_VERSION_STR, platform.system()))
</code></pre><p><code>QMessageBox.about()</code>静态方法弹出一个给定标题和文本的只有OK按钮的模式对话框，其文本可以是HTML。</p>
<h1 id="总结">总结</h1><p>主窗口风格的程序由<code>QMainWindow</code>子类创建，其窗口只有一个单一的部件作为中央部件。</p>
<p>动作用来表示程序向用户提供的功能。这些动作保存在<code>QAction</code>对象中，包含文本(用于菜单)，图标(用于菜单<br>和工具栏)，工具栏提示和状态栏提示，以及所连接的槽。<br>通常所有的动作都会添加进菜单，而只有经常使用的一些加入工具栏。</p>
<p>动作，动作组和悬浮窗必须显式提供一个父亲，比如主窗口，以保证在合适的时候能被销毁。</p>
<p>程序通常使用资源(小文件，比如图标，和数据文件)，PyQt的资源机制使得访问和使用资源非常简单。使用<br><code>pyrcc4</code>将资源文件编程Python模块，再导入程序使用。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/PyQt/">PyQt</a><a href="/tags/Python/">Python</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://opensvn.github.io/2015/10/21/pyqt-6/" data-title="PyQt编程第六章 主窗口 | opensvn" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/10/23/project-euler-1/" title="Project Euler Problem 1">
  <strong>上一篇：</strong><br/>
  <span>
  Project Euler Problem 1</span>
</a>
</div>


<div class="next">
<a href="/2015/10/14/pyqt-5/"  title="PyQt编程第五章 对话框">
 <strong>下一篇：</strong><br/> 
 <span>PyQt编程第五章 对话框
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/10/21/pyqt-6/" data-title="PyQt编程第六章 主窗口" data-url="https://opensvn.github.io/2015/10/21/pyqt-6/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/PyQt/" title="PyQt">PyQt<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/C-C/" title="C/C++">C/C++<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Pygame/" title="Pygame">Pygame<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Markdown/" title="Markdown">Markdown<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Project-Euler/" title="Project Euler">Project Euler<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, I&#39;m opensvn. <br/>
			Try to do better.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/opensvn" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="opensvn">opensvn</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"opensvn"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F86bb0f34aeafce8b9262f5000b269d72' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
